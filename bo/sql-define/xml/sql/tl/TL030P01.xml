<?xml version="1.0" encoding="utf-8"?>
<sql-included>
	<sql-list>
		<!-- 売変確定 一覧 件数チェック-->
		<sql id="TL030P01-01">
			<statement type="final" name="final">
				<parts>
					SELECT NVL(SUM(CNT),0) CNT
					FROM
					(
					-- 売価変更指示TBL
					SELECT /*+ INDEX(MDCT0010 MDCT0010_INDEX2) */
							 	COUNT(1) CNT
					FROM	 	MDCT0010 T1		/* 売変指示 */
					LEFT JOIN	MDCT0040 T2		/* 事前売変 */
					ON			T1.TENPO_CD		 = T2.TENPO_CD
					AND			T1.BAIHENKAISI_YMD = T2.BAIHENKAISI_YMD
					AND			T1.BAIHEN_NO       = T2.BAIHEN_NO
					AND			T1.BAIHENGYO_NO    = T2.BAIHENGYO_NO
					AND			T1.JISYA_HBN       = T2.JISYA_HBN
					AND			T1.IRO_CD          = T2.IRO_CD
					WHERE		0=0
				</parts>
			</statement>
			<!-- 検索条件-->
			<statement type="replace" name="WHERE_01"/>
			<statement type="final" name="final">
				<parts>
					GROUP BY
								 T1.TENPO_CD
								,T1.BAIHENKAISI_YMD
								,T1.BUMON_CD
								,T1.BURANDO_CD
				</parts>
			</statement>
			<statement type="final" name="final">
				<parts>
					 UNION ALL
				</parts>
			</statement>

			<statement type="final" name="final">
				<parts>
					-- 店舗売変予定TBL
					SELECT
							COUNT(1) CNT
					FROM 	MDCT0020 T1		/* 売変予定 */
					WHERE	0=0
				</parts>
			</statement>
			<!-- 検索条件-->
			<statement type="replace" name="WHERE_02"/>
			<statement type="final" name="final">
				<parts>
					GROUP BY
							T1.TENPO_CD
							,T1.BAIHENKAISI_YMD
							,T1.BAIHEN_NO
							,T1.BUMON_CD
				)
				</parts>
			</statement>
		</sql>
		<!-- 売変確定 一覧 一覧検索-->
		<sql id="TL030P01-02">
			<statement type="final" name="final">
				<parts>
					SELECT /*+ INDEX(MDCT0010 MDCT0010_INDEX2) */
						 '' HANBAIIN_NM					/* 1  申請担当者 */
						,T1.BUMON_CD					/* 2  部門コード */
						,MAX(M1.BUMON_NM) BUMON_NM		/* 3  部門名 */
						,T1.BAIHENKAISI_YMD 			/* 4  売変開始日 */
						,COUNT(1) HINBAN_SU				/* 5  品番数 */
				</parts>
			</statement>
			<!-- 項目追加-->
			<statement type="replace" name="SELECT_01"/>
			<statement type="final" name="final">
				<parts>
						ZAIKO_SU							  /* 6	在庫点数 */
						,''  KAKUTEI_TAN_NM 				  /* 7	確定担当者 */
						,0	 KAKUTEI_YMD					  /* 8	確定日 */
						,0	 KAKUTEI_TM 					  /* 9	確定時間 */
						,''  SINSEITAN_CD					  /* 10 申請担当者コード */
						,''  KAKUTEI_TAN_CD					  /* 11 確定担当者コード */
						,MAX(T1.BAIHEN_NO) BAIHEN_NO		  /* 12 売変NO */
						,TO_NUMBER(SUBSTR(MAX(TO_CHAR(T1.UPD_YMD, 'FM00000000') || TO_CHAR(T1.UPD_TM, 'FM000000000')), 1, 8)) UPD_YMD	/* 13 更新日 */
						,TO_NUMBER(SUBSTR(MAX(TO_CHAR(T1.UPD_YMD, 'FM00000000') || TO_CHAR(T1.UPD_TM, 'FM000000000')), 9))    UPD_TM	/* 14 更新時間 */
--						,MAX(T1.UPD_YMD)   UPD_YMD			  /* 13 更新日 */
--						,MAX(T1.UPD_TM)    UPD_TM			  /* 14 更新時間 */
						,MAX(T1.UPD_TANCD) UPD_TANCD		  /* 15 更新担当者コード */
						,'' HHTSERIAL_NO					  /* 16 HHTシリアル番号 */
						,0	HHTSEQUENCE_NO					  /* 17 HHTシーケンスNO */
						,0	PRINT_FLG						  /* 18 印刷対象存在フラグ */
						,MAX(M1.BUMONKANA_NM) BUMONKANA_NM
															  /* 19 部門カナ名 */
						,MAX(M2.MEISYO_NM) SIMSEIMOTO_NM
															  /* 20 申請元(名称) */
						,1 SINSEIMOTO_KBN					  /* 21 申請元区分 */
						,MAX(T1.SINSEICOMMENT_NM)	SINSEICOMMENT_NM
															  /* 22 申請コメント */
						,MAX(T1.BAIHENSAGYOKAISI_YMD) BAIHENSAGYOKAISI_YMD
															  /* 23 作業開始日 */
						,MAX(RIYU.MEISYO_NM) BAIHEN_RIYTU_NM  /* 24 売変理由(名称) */
						,T1.BAIHEN_RIYTU BAIHEN_RIYTU		  /* 25 売変理由(コード) */
					FROM
						MDCT0010 T1,BOMT0060 M1,MDMT0100 M2,MDMT0100 RIYU      /* 売変指示,部門マスタ,名称マスタ */
						,MDCT0040 T2		/* 事前売変 */
					WHERE T1.BUMON_CD        = M1.BUMON_CD(+)
						AND M2.MEISYO_CD(+)    = '1'
						AND M2.SIKIBETSU_CD(+) = 'PCSM'
						AND RIYU.MEISYO_CD(+)    = T1.BAIHEN_RIYTU
						AND RIYU.SIKIBETSU_CD(+) = 'BHRY'
						AND	T1.TENPO_CD        = T2.TENPO_CD(+)
						AND	T1.BAIHENKAISI_YMD = T2.BAIHENKAISI_YMD(+)
						AND	T1.BAIHEN_NO       = T2.BAIHEN_NO(+)
						AND	T1.BAIHENGYO_NO    = T2.BAIHENGYO_NO(+)
						AND	T1.JISYA_HBN       = T2.JISYA_HBN(+)
						AND	T1.IRO_CD          = T2.IRO_CD(+)
				</parts>
			</statement>
			<!-- 検索条件-->
			<statement type="replace" name="WHERE_01"/>
			<statement type="final" name="final">
				<parts>
					GROUP BY
							T1.TENPO_CD
							,T1.BAIHENKAISI_YMD
							,T1.BAIHEN_NO
							,T1.BUMON_CD
							,T1.BAIHENSAGYOKAISI_YMD
							,T1.BAIHEN_RIYTU
				</parts>
			</statement>
			<statement type="final" name="final">
				<parts>
					 UNION ALL
				</parts>
			</statement>
			<statement type="final" name="final">
				<parts>
					-- 店舗売変予定TBL
					SELECT
						 MAX(M1.HANBAIIN_NM) HANBAIIN_NM			/* 1  申請担当者 */
						,T1.BUMON_CD								/* 2  部門コード */
						,MAX(M2.BUMON_NM) BUMON_NM					/* 3  部門名 */
						,MAX(T1.BAIHENKAISI_YMD) BAIHENKAISI_YMD	/* 4  売変開始日 */
						,COUNT(1) HINBAN_SU							/* 5  品番数 */
				</parts>
			</statement>
			<!-- 項目追加-->
			<statement type="replace" name="SELECT_02"/>
			<statement type="final" name="final">
				<parts>
						ZAIKO_SU									/* 6	在庫点数 */
						,''  KAKUTEI_TAN_NM 						/* 7	確定担当者 */
						,0	 KAKUTEI_YMD							/* 8	確定日 */
						,0	 KAKUTEI_TM 							/* 9	確定時間 */
						,MAX(T1.SINSEITAN_CD) SINSEITAN_CD	/* 10 申請担当者コード */
						,''  KAKUTEI_TAN_CD							/* 11 確定担当者コード */
						,MAX(T1.BAIHEN_NO) BAIHEN_NO				/* 12 売変NO */
						,TO_NUMBER(SUBSTR(MAX(TO_CHAR(T1.UPD_YMD, 'FM00000000') || TO_CHAR(T1.UPD_TM, 'FM000000000')), 1, 8)) UPD_YMD		/* 13 更新日 */
						,TO_NUMBER(SUBSTR(MAX(TO_CHAR(T1.UPD_YMD, 'FM00000000') || TO_CHAR(T1.UPD_TM, 'FM000000000')), 9))    UPD_TM		/* 14 更新時間 */
--						,MAX(T1.UPD_YMD) UPD_YMD					/* 13 更新日 */
--						,MAX(T1.UPD_TM) UPD_TM						/* 14 更新時間 */
						,MAX(T1.UPD_TANCD) UPD_TANCD				/* 15 更新担当者コード */
						,MAX(T1.HHTSERIAL_NO) HHTSERIAL_NO	/* 16 HHTシリアル番号 */
						,MAX(T1.HHTSEQUENCE_NO) HHTSEQUENCE_NO
																	/* 17 HHTシーケンスNO */
						,0 PRINT_FLG								/* 18 印刷対象存在フラグ */
						,MAX(M2.BUMONKANA_NM) BUMONKANA_NM
																	/* 19 部門カナ名 */
						,MAX(M3.MEISYO_NM) SIMSEIMOTO_NM
																	/* 20 申請元(名称) */
						,2 SINSEIMOTO_KBN							/* 21 申請元区分 */
						,''	SINSEICOMMENT_NM						/* 22 申請コメント */
						,0	BAIHENSAGYOKAISI_YMD					/* 23 作業開始日 */
						,'' BAIHEN_RIYTU_NM							/* 24 売変理由(名称) */
						,0 BAIHEN_RIYTU								/* 25 売変理由(コード) */
					FROM
						MDCT0020 T1,BOMT0030 M1,BOMT0060 M2,MDMT0100 M3      /* 売変予定,担当者マスタ,部門マスタ,名称マスタ */
					WHERE T1.SINSEITAN_CD    = M1.HANBAIIN_CD(+)
						AND   T1.BUMON_CD        = M2.BUMON_CD(+)
						AND   M3.MEISYO_CD(+)    = '2'
						AND   M3.SIKIBETSU_CD(+) = 'PCSM'
				</parts>
			</statement>
			<!-- 検索条件-->
			<statement type="replace" name="WHERE_02"/>
			<statement type="final" name="final">
				<parts>
					GROUP BY
						 T1.TENPO_CD
						,T1.BAIHENKAISI_YMD
						,T1.BAIHEN_NO
						,T1.BUMON_CD
				</parts>
			</statement>
			<statement type="final" name="final">
				<parts>
					ORDER BY
							 SINSEITAN_CD
							,BUMON_CD
							,BAIHENKAISI_YMD
							,BAIHEN_RIYTU
							,BAIHEN_NO
				</parts>
			</statement>
		</sql>
		<!-- 売変確定 一覧 売変確定ワークTBL存在チェック-->
		<sql id="TL030P01-03">
			<statement type="final" name="final">
				<parts>
					SELECT
						COUNT(*) AS CNT
					FROM
						W_MDCT0030
					WHERE 0=0
				</parts>
			</statement>
			<statement type="replace" name="ADD_WHERE1" />
		</sql>
		<!-- 売変確定 一覧 明細リンク(売価変更指示TBL)-->
		<sql id="TL030P01-04">
			<statement type="final" name="final">
				<parts>
					SELECT
						 BAIHENGYO_NO
						,HINSYU_RYAKU_NM
						,JISYA_HBN
						,MAKER_HBN
						,IRO_CD
						,IRO_NM
						,SEASON_KB
						,GENBAIKA_TNK
						,SIJIBAIKA_TNK
						,GEN_TNK
						,ZAIKO_SU
						,KAKUTEIBAIKA_TNK
						,URIAGE_SU
						,FLG
						,BAIHENKAISI_YMD
						,BAIHENSYURYO_YMD
						,BAIHEN_NO
						,BUMON_CD
						,HINSYU_CD
						,BURANDO_CD
						,BURANDO_NMK
						,SYONMK
						,JODAI1_TNK
						,HANDLBL_KB
						,UPD_YMD
						,UPD_TM
						,UPD_TANCD
						,CASE WHEN </parts><bind id="BIND_BAIKAEQUAL_FLG_01" /><parts> = 1 THEN 3 ELSE SHONIN_FLG END SHONIN_FLG
						,HANBAIKANRYO_YMD
						,CASE
							WHEN OLD_COLOR_FLG = 1 THEN
													(CASE WHEN ROW_NUMBER() OVER(PARTITION BY JISYA_HBN ORDER BY JISYA_HBN, IRO_CD) = 1 THEN 1
													ELSE 0 END)
							ELSE 1 END CHG_FLG
						,OLD_COLOR_FLG
						,JISYA_HBN_CNT
						,(SELECT UPD_TANCD FROM W_MDCT0030 WHERE W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ" /><parts> AND W_MDCT0030.UPD_YMD = A.UPD_YMD AND W_MDCT0030.UPD_TM = A.UPD_TM AND W_MDCT0030.UPD_TANCD = A.UPD_TANCD) UPD_TANCD_WK
					FROM
					(
						SELECT
								 MDCT0010.BAIHENGYO_NO			/* 1  行 */
								,MDMT0070.HINSYU_RYAKU_NM		/* 2  品種名 */
								,MDCT0010.JISYA_HBN				/* 3  自社品番 */
								,MDCT0010.MAKER_HBN				/* 4  メーカー品番 */
								,MDCT0010.IRO_CD				/* 5  色コード */
								,MDMT0080.IRO_NM				/* 6  色名 */
								,MDCT0010.SEASON_KB				/* 7  シーズン */
								,MIN(CASE
										WHEN KAKUTEI_FLG = 1 THEN MDCT0010.GENBAIKA_TNK
										ELSE (CASE WHEN STMT0091.SLPR IS NULL THEN MDMT0130.SLPR ELSE STMT0091.SLPR END)
								 END) GENBAIKA_TNK				/* 8  現売価 */
								,MDCT0010.SIJIBAIKA_TNK			/* 9  指示売価 */
								,MDCT0010.GEN_TNK				/* 10 原単価 */
								,MAX(
									CASE
										WHEN MDCT0010.KAKUTEI_FLG = 0 THEN
											( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
											+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
											+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0))
										ELSE
											MDCT0010.ZAIKO_SU
									END
								 ) ZAIKO_SU						/* 11 在庫数 */
								,MDCT0010.SIJIBAIKA_TNK KAKUTEIBAIKA_TNK	/* 12 確定売価 */
								,MDCT0010.URIAGE_SU				/* 13 売上数 */
								,MIN(CASE
								--事前売変データがある場合、3で検索
									WHEN	(
												SELECT	COUNT(1)
												FROM	MDCT0040
												WHERE	TENPO_CD		=	MDCT0010.TENPO_CD
												AND		BAIHENKAISI_YMD	=	MDCT0010.BAIHENKAISI_YMD
												AND		BAIHEN_NO		=	MDCT0010.BAIHEN_NO
												AND		BAIHENGYO_NO	=	MDCT0010.BAIHENGYO_NO
												AND		JISYA_HBN		=	MDCT0010.JISYA_HBN
												AND		IRO_CD			=	MDCT0010.IRO_CD
											) &gt; 0	THEN	(SELECT	MDMT0100.MEISYO_NM	FROM MDMT0100	WHERE	MDMT0100.MEISYO_CD(+) = '3'	AND	MDMT0100.SIKIBETSU_CD(+) = 'PCSN')
								--自動売変延長データがある場合、4
									WHEN	(
												SELECT	COUNT(1)
												FROM	MDCT0050
												WHERE	TENPO_CD		=	MDCT0010.TENPO_CD
												AND		BAIHENKAISI_YMD	=	MDCT0010.BAIHENKAISI_YMD
												AND		BAIHEN_NO		=	MDCT0010.BAIHEN_NO
												AND		BAIHENGYO_NO	=	MDCT0010.BAIHENGYO_NO
												AND		JISYA_HBN		=	MDCT0010.JISYA_HBN
												AND		IRO_CD			=	MDCT0010.IRO_CD
												AND		SAKUJYO_FLG		=	0
											) &gt; 0	THEN	(SELECT	MDMT0100.MEISYO_NM	FROM MDMT0100	WHERE	MDMT0100.MEISYO_CD(+) = '4'	AND	MDMT0100.SIKIBETSU_CD(+) = 'PCSN')
									ELSE
											' '
								END) FLG
								,MDCT0010.BAIHENKAISI_YMD		/* 15 売変開始日 */
								,MDCT0010.BAIHENSYURYO_YMD		/* 16 売変終了日 */
								,MDCT0010.BAIHEN_NO				/* 17 売変NO */
								,MDCT0010.BUMON_CD				/* 18 部門コード */
								,MDCT0010.HINSYU_CD				/* 19 品種コード */
								,MDCT0010.BURANDO_CD			/* 20 ブランドコード */
								,STMT0500.BURANDO_NMK			/* 21 ブランド名 */
								,MDCT0010.SYONMK				/* 22 商品名(カナ) */
								,MDCT0010.JODAI1_TNK			/* 23 上代1 */
								,MDCT0010.HANDLBL_KB			/* 24 ハンドラベル */
								,MDCT0010.UPD_YMD				/* 25 更新日 */
								,MDCT0010.UPD_TM				/* 26 更新時間 */
								,MDCT0010.UPD_TANCD				/* 27 更新担当者コード */
								,MIN(CASE
								--事前売変データがある場合、3
									WHEN	(
												SELECT	COUNT(1)
												FROM	MDCT0040
												WHERE	TENPO_CD		=	MDCT0010.TENPO_CD
												AND		BAIHENKAISI_YMD	=	MDCT0010.BAIHENKAISI_YMD
												AND		BAIHEN_NO		=	MDCT0010.BAIHEN_NO
												AND		BAIHENGYO_NO	=	MDCT0010.BAIHENGYO_NO
												AND		JISYA_HBN		=	MDCT0010.JISYA_HBN
												AND		IRO_CD			=	MDCT0010.IRO_CD
											) &gt; 0	THEN	3
								--自動売変延長データがある場合、4
									WHEN	(
												SELECT	COUNT(1)
												FROM	MDCT0050
												WHERE	TENPO_CD		=	MDCT0010.TENPO_CD
												AND		BAIHENKAISI_YMD	=	MDCT0010.BAIHENKAISI_YMD
												AND		BAIHEN_NO		=	MDCT0010.BAIHEN_NO
												AND		BAIHENGYO_NO	=	MDCT0010.BAIHENGYO_NO
												AND		JISYA_HBN		=	MDCT0010.JISYA_HBN
												AND		IRO_CD			=	MDCT0010.IRO_CD
												AND		SAKUJYO_FLG		=	0
											) &gt; 0	THEN	4
									ELSE
											0
								END) SHONIN_FLG
								,MAX(MDMT0130.HANBAIKANRYO_YMD) HANBAIKANRYO_YMD	/* 29 販売完了日 */
								,MAX(CASE WHEN MDMT0130.OLD_XEBIO_CD &lt;&gt; '0000000000' AND MDMT0130.TENKAI_KB = 2 THEN 1 ELSE 0 END) OLD_COLOR_FLG
								,COUNT(1) OVER(PARTITION BY JISYA_HBN) JISYA_HBN_CNT
								,CASE
									WHEN	-- 旧品番のカラー管理商品で抽出件数が1件以上ある場合
										(MAX(CASE WHEN MDMT0130.OLD_XEBIO_CD &lt;&gt; '0000000000' AND MDMT0130.TENKAI_KB = 2 THEN 1 ELSE 0 END) ) = 1
										AND (COUNT(1) OVER(PARTITION BY JISYA_HBN) ) &gt; 1 THEN 1
									ELSE 0
								END SORT1
						FROM
								 MDCT0010					/* 売価変更指示TBL */
								,MDMT0070					/* 品種MST */
								,MDMT0080					/* 色MST */
								,MDMT0130					/* 共通商品 */
								,STMT0091					/* 店別単価 */
								,MDMT0100					/* 名称MST */
								,STMT0500					/* ブランドMST */
						WHERE	MDCT0010.BUMON_CD			= MDMT0070.BUMON_CD(+)
						AND		MDCT0010.HINSYU_CD			= MDMT0070.HINSYU_CD(+)
						AND		MDCT0010.IRO_CD				= MDMT0080.IRO_CD(+)
						AND		MDCT0010.BURANDO_CD			= STMT0500.BURANDO_CD(+)
						AND		MDMT0100.MEISYO_CD(+)		= 1
						AND		MDMT0100.SIKIBETSU_CD(+)	= 'PCSN'
						AND		MDMT0130.XEBIO_CD			= MDCT0010.JISYA_HBN
						AND		MDMT0130.MAKERCOLOR_CD		= MDCT0010.IRO_CD
						AND		STMT0091.SOSIKI				= '0001'
						AND		STMT0091.TENCD				= </parts><bind id="BIND_TENPO_CD_04" /><parts>
						AND		STMT0091.SKU				= MDMT0130.JAN_CD
						AND	(
								(
									(CASE
										WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
										WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
									END) = </parts><bind id="BIND_BAIKAEQUAL_FLG_02" /><parts>
									AND	MDCT0010.ADD_KBN = '1'
								)
								OR	(MDCT0010.ADD_KBN = '2')
							)
						AND	MDCT0010.TENPO_CD			=	</parts><bind id="BIND_TENPO_CD_05" /><parts>
						AND	MDCT0010.BAIHENKAISI_YMD	=	</parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
						AND	MDCT0010.BAIHEN_NO			=	</parts><bind id="BIND_BAIHEN_NO" /><parts>
						AND		((
									CASE
										WHEN MDCT0010.KAKUTEI_FLG = 0 THEN
											( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_06" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
											+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_07" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
											+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_08" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0))
										ELSE
											MDCT0010.ZAIKO_SU
									END &gt; 0 AND MDCT0010.ADD_KBN = 1)
								OR (MDCT0010.ADD_KBN = 2)
								)
						AND		MDCT0010.BAIHEN_RIYTU			&lt;&gt;	3													/* 売変理由 */
						/* 未確定行か今回確定された行は表示する*/
						AND		(
									MDCT0010.KAKUTEI_FLG			=	0														/* 確定フラグ */
								OR
									EXISTS(
											SELECT 1
											FROM
													W_MDCT0030
											WHERE
													W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_02" /><parts>
											AND		W_MDCT0030.UPD_YMD = MDCT0010.UPD_YMD
											AND		W_MDCT0030.UPD_TM = MDCT0010.UPD_TM
											AND		W_MDCT0030.UPD_TANCD = MDCT0010.UPD_TANCD
									)
								)
						AND		MDCT0010.BUMON_CD  				=	</parts><bind id="BIND_BUMON_CD" /><parts>					/* 部門コード */
						AND		MDCT0010.BAIHENSAGYOKAISI_YMD	=	</parts><bind id="BIND_BAIHENSAGYOKAISI_YMD" /><parts>		/* 売変作業開始日 */
						AND		MDCT0010.BAIHEN_RIYTU 			=	</parts><bind id="BIND_BAIHEN_RIYTU" /><parts>				/* 売変理由 */
						GROUP BY
							 MDCT0010.BAIHENGYO_NO
							,MDMT0070.HINSYU_RYAKU_NM
							,MDCT0010.JISYA_HBN
							,MDCT0010.MAKER_HBN
							,MDCT0010.IRO_CD
							,MDMT0080.IRO_NM
							,MDCT0010.SEASON_KB
							,MDCT0010.SIJIBAIKA_TNK
							,MDCT0010.GEN_TNK
							,MDCT0010.ZAIKO_SU
							,MDCT0010.SIJIBAIKA_TNK
							,MDCT0010.URIAGE_SU
							,MDCT0010.BAIHENKAISI_YMD
							,MDCT0010.BAIHENSYURYO_YMD
							,MDCT0010.BAIHEN_NO
							,MDCT0010.BUMON_CD
							,MDCT0010.HINSYU_CD
							,MDCT0010.BURANDO_CD
							,STMT0500.BURANDO_NMK
							,MDCT0010.SYONMK
							,MDCT0010.JODAI1_TNK
							,MDCT0010.HANDLBL_KB
							,MDCT0010.UPD_YMD
							,MDCT0010.UPD_TM
							,MDCT0010.UPD_TANCD
					) A
					ORDER BY
						 SORT1 DESC
						,HINSYU_CD
						,BURANDO_CD
						,JISYA_HBN
						,CHG_FLG DESC
						,IRO_CD
				</parts>
			</statement>
		</sql>
		<!-- 売変確定 一覧 明細リンク(店舗売変予定TBL)-->
		<sql id="TL030P01-05">
			<statement type="final" name="final">
				<parts>
					SELECT
							 MDCT0020.BAIHENGYO_NO								/* 1  行 */
							,MDMT0070.HINSYU_RYAKU_NM							/* 2  品種名 */
							,MDCT0020.JISYA_HBN									/* 3  自社品番 */
							,MDCT0020.MAKER_HBN									/* 4  メーカー品番 */
							,MDCT0020.IRO_CD									/* 5  色コード */
							,MDMT0080.IRO_NM									/* 6  色名 */
							,MDCT0020.SEASON_KB									/* 7  シーズン */
							,MIN(CASE
									WHEN KAKUTEI_FLG = 1 THEN MDCT0020.GENBAIKA_TNK	
									ELSE (CASE WHEN STMT0091.SLPR IS NULL THEN MDMT0130.SLPR ELSE STMT0091.SLPR END)
							 END) GENBAIKA_TNK									/* 8  現売価 */
							,MDCT0020.SIJIBAIKA_TNK								/* 9  指示売価 */
							,MDCT0020.GEN_TNK									/* 10 原単価 */
							,MAX( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0020.IRO_CD), 0)
								+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0020.IRO_CD), 0)
								+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0020.IRO_CD), 0)
							 )	ZAIKO_SU										/* 11 在庫数 */
							,MAX(CASE 
								WHEN KAKUTEI_FLG = 1 THEN 
									(SELECT MDCT0030.KAKUTEIBAIKA_TNK 
									FROM MDCT0030 
									WHERE MDCT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDCT0030.BAIHENKAISI_YMD = MDCT0020.BAIHENKAISI_YMD AND MDCT0030.BAIHEN_NO = MDCT0020.BAIHEN_NO AND MDCT0030.BAIHENGYO_NO = MDCT0020.BAIHENGYO_NO AND MDCT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDCT0030.IRO_CD = MDCT0020.IRO_CD
									)
								ELSE MDCT0020.SIJIBAIKA_TNK END) KAKUTEIBAIKA_TNK /* 12 確定売価 */
							,MDCT0020.URIAGE_SU									/* 13 売上数 */
							,'1' FLG											/* 14 承認状態(名称) (検索画面で使用しているので、1固定)*/ 
							,MDCT0020.BAIHENKAISI_YMD							/* 15 売変開始日 */
							,MDCT0020.BAIHENSYURYO_YMD							/* 16 売変終了日 */
							,MDCT0020.BAIHEN_NO									/* 17 売変NO */
							,MDCT0020.BUMON_CD									/* 18 部門コード */
							,MDCT0020.HINSYU_CD									/* 19 品種コード */
							,MDCT0020.BURANDO_CD								/* 20 ブランドコード */
							,STMT0500.BURANDO_NMK								/* 21 ブランド名 */
							,MDCT0020.SYONMK									/* 22 商品名(カナ) */
							,MDCT0020.JODAI1_TNK								/* 23 上代1 */
							,MDCT0020.HANDLBL_KB								/* 24 ハンドラベル */
							,MDCT0020.UPD_YMD									/* 25 更新日 */
							,MDCT0020.UPD_TM									/* 26 更新時間 */
							,MDCT0020.UPD_TANCD									/* 27 更新担当者コード */
							,MAX(CASE 
								WHEN KAKUTEI_FLG = 1 THEN 
									(SELECT MDCT0030.SYONIN_FLG 
									FROM MDCT0030 
									WHERE MDCT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDCT0030.BAIHENKAISI_YMD = MDCT0020.BAIHENKAISI_YMD AND MDCT0030.BAIHEN_NO = MDCT0020.BAIHEN_NO AND MDCT0030.BAIHENGYO_NO = MDCT0020.BAIHENGYO_NO AND MDCT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDCT0030.IRO_CD = MDCT0020.IRO_CD
									)
								ELSE 1 END) SHONIN_FLG							/* 28 承認状態 (確定を行う場合の判断に使用) */
							,MAX(MDMT0130.HANBAIKANRYO_YMD) HANBAIKANRYO_YMD	/* 29 販売完了日 */
							,MAX(CASE WHEN MDCT0020.ADDTAN_CD IS NULL THEN 0 ELSE 1 END) CHG_FLG
							,MAX(CASE WHEN MDMT0130.OLD_XEBIO_CD &lt;&gt; '0000000000' AND MDMT0130.TENKAI_KB = 2 THEN 1 ELSE 0 END) OLD_COLOR_FLG
							,COUNT(1) OVER (PARTITION BY JISYA_HBN) JISYA_HBN_CNT
							,(SELECT UPD_TANCD FROM W_MDCT0030 WHERE W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ" /><parts> AND W_MDCT0030.UPD_YMD = MDCT0020.UPD_YMD AND W_MDCT0030.UPD_TM = MDCT0020.UPD_TM AND W_MDCT0030.UPD_TANCD = MDCT0020.UPD_TANCD) UPD_TANCD_WK
					FROM
							 MDCT0020			/* 売価変更予定TBL */
							,MDMT0070			/* 品種MST */
							,MDMT0080			/* 色MST */
							,MDMT0130			/* 発注マスタ */
							,STMT0091			/* 店別単価 */
							,STMT0500			/* ブランドマスタ */
					WHERE 	MDCT0020.BUMON_CD	= MDMT0070.BUMON_CD(+)
					AND 	MDCT0020.HINSYU_CD	= MDMT0070.HINSYU_CD(+)
					AND 	MDCT0020.IRO_CD		= MDMT0080.IRO_CD(+)
					AND		MDCT0020.BURANDO_CD	= STMT0500.BURANDO_CD(+)
					AND		STMT0091.SOSIKI			= '0001'
					AND		STMT0091.TENCD			= </parts><bind id="BIND_TENPO_CD_04" /><parts>
					AND		MDCT0020.JISYA_HBN		= MDMT0130.XEBIO_CD
					AND		STMT0091.SKU			= MDMT0130.JAN_CD
					AND		MDMT0130.MAKERCOLOR_CD	= MDCT0020.IRO_CD
					AND		(CASE
								WHEN (MDCT0020.SIJIBAIKA_TNK &lt;&gt; MDCT0020.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0020.SIJIBAIKA_TNK =  MDCT0020.GENBAIKA_TNK) THEN 1
							END) = </parts><bind id="BIND_BAIKAEQUAL_FLG_01" /><parts>
					AND 		MDCT0020.TENPO_CD	= </parts><bind id="BIND_TENPO_CD_05" /><parts>
					AND 		MDCT0020.BAIHENKAISI_YMD = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND 		MDCT0020.BAIHEN_NO	= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					/* 未確定行か今回確定された行は表示する*/
					AND		(
								MDCT0020.KAKUTEI_FLG	=	0		/* 確定フラグ */
							OR
								EXISTS(
										SELECT 1
										FROM
												W_MDCT0030
										WHERE
												W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_02" /><parts>
										AND		W_MDCT0030.UPD_YMD = MDCT0020.UPD_YMD
										AND		W_MDCT0030.UPD_TM = MDCT0020.UPD_TM
										AND		W_MDCT0030.UPD_TANCD = MDCT0020.UPD_TANCD
								)
							)
					AND			MDCT0020.BUMON_CD	=	</parts><bind id="BIND_BUMON_CD" /><parts>
					GROUP BY
							 MDCT0020.BAIHENGYO_NO
							,MDMT0070.HINSYU_RYAKU_NM
							,MDCT0020.JISYA_HBN
							,MDCT0020.MAKER_HBN
							,MDCT0020.IRO_CD
							,MDMT0080.IRO_NM
							,MDCT0020.SEASON_KB
							,MDCT0020.SIJIBAIKA_TNK
							,MDCT0020.GEN_TNK
							,MDCT0020.ZAIKO_SU
							,MDCT0020.URIAGE_SU
							,MDCT0020.BAIHENKAISI_YMD
							,MDCT0020.BAIHENSYURYO_YMD
							,MDCT0020.BAIHEN_NO
							,MDCT0020.BUMON_CD
							,MDCT0020.HINSYU_CD
							,MDCT0020.BURANDO_CD
							,STMT0500.BURANDO_NMK
							,MDCT0020.SYONMK
							,MDCT0020.JODAI1_TNK
							,MDCT0020.HANDLBL_KB
							,MDCT0020.UPD_YMD
							,MDCT0020.UPD_TM
							,MDCT0020.UPD_TANCD
					ORDER BY
							CASE
								WHEN
									(MAX(CASE WHEN MDMT0130.OLD_XEBIO_CD &lt;&gt; '0000000000' AND MDMT0130.TENKAI_KB = 2 THEN 1 ELSE 0 END) ) = 1
									AND (COUNT(1) OVER(PARTITION BY JISYA_HBN)) &gt; 1 THEN 1
								ELSE 0
							END DESC
							,HINSYU_CD
							,BURANDO_CD
							,JISYA_HBN
							,CHG_FLG DESC
							,IRO_CD
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 自動売変延長データTBL削除-->
		<sql id="TL030P01-06">
			<statement type="final" name="final">
				<parts>
					DELETE MDCT0050
					WHERE
					    MDCT0050.TENPO_CD        = </parts><bind id="BIND_TENPO_CD" /><parts>
					AND MDCT0050.BAIHENKAISI_YMD = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND MDCT0050.BAIHEN_NO       = </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND MDCT0050.SAKUJYO_FLG     = 0
					AND EXISTS (
								SELECT 1
								  FROM MDCT0010
								 WHERE
									  MDCT0010.TENPO_CD        = MDCT0050.TENPO_CD
								  AND MDCT0010.BAIHENKAISI_YMD = MDCT0050.BAIHENKAISI_YMD
								  AND MDCT0010.BAIHEN_NO       = MDCT0050.BAIHEN_NO
								  AND MDCT0010.BAIHENGYO_NO    = MDCT0050.BAIHENGYO_NO
								  AND MDCT0010.JISYA_HBN       = MDCT0050.JISYA_HBN
								  AND MDCT0010.IRO_CD          = MDCT0050.IRO_CD
								  AND MDCT0010.BUMON_CD        = </parts><bind id="BIND_BUMON_CD" /><parts>
								  AND MDCT0010.BAIHEN_RIYTU    = </parts><bind id="BIND_BAIHEN_RIYTU" /><parts>
								  AND (CASE
											WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
											WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
									   END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" /><parts>)</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 売変確定一時TBL登録-->
		<sql id="TL030P01-07">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030_TEMP (
						 BAIHEN_NO															/*  4 売変NO */
						,TENPO_CD															/*  1 店舗コード */
						,JISYA_HBN															/*  6 自社品番 */
						,IRO_CD																/*  7 色コード */
						,KAKUTEIBAIKA_TNK													/* 22 確定売価 */
						,UPD_YMD															/* 13 更新日 */
						,UPD_TM																/* 14 更新時間 */
					) SELECT
						 MDCT0010.BAIHEN_NO													/*  4 売変NO */
						,MDCT0010.TENPO_CD													/*  1 店舗コード */
						,MDCT0010.JISYA_HBN													/*  6 自社品番 */
						,MDCT0010.IRO_CD													/*  7 色コード */
						,MDCT0010.SIJIBAIKA_TNK												/* 22 確定売価 */
						,</parts><bind id="BIND_UPD_YMD" /><parts>							/* 13 更新日 */
						,SUBSTR(LPAD(</parts><bind id="BIND_UPD_TM" /><parts>,9,'0'),0,6)	/* 14 更新時間 */
					FROM
							MDCT0010			/* 売価変更指示TBL */
					WHERE
							EXISTS(
								SELECT 1
								FROM
										 MDMT0130
										,STMT0091
								WHERE
										MDMT0130.XEBIO_CD		= MDCT0010.JISYA_HBN
								AND		MDMT0130.MAKERCOLOR_CD	= MDCT0010.IRO_CD
								AND		STMT0091.SOSIKI			= '0001'
								AND		STMT0091.TENCD			= </parts><bind id="BIND_TENPO_CD_01" /><parts>
								AND		STMT0091.SKU			= MDMT0130.JAN_CD
							)
					AND(	(MDCT0010.SIJIBAIKA_TNK	= MDCT0010.GENBAIKA_TNK
							AND	MDCT0010.ADD_KBN	= '1')
						OR	(MDCT0010.ADD_KBN		= '2')
					)
					AND 	MDCT0010.TENPO_CD			= </parts><bind id="BIND_TENPO_CD_02" /><parts>
					AND 	MDCT0010.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND 	MDCT0010.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND		((
								CASE
									WHEN MDCT0010.KAKUTEI_FLG = 0 THEN
										( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_04" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_05" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0))
									ELSE
										MDCT0010.ZAIKO_SU
								END > 0 AND MDCT0010.ADD_KBN = 1)
							OR (MDCT0010.ADD_KBN = 2)
							)
					AND		MDCT0010.BAIHEN_RIYTU			&lt;&gt; 3
					AND		MDCT0010.KAKUTEI_FLG			=  0
					AND		MDCT0010.BUMON_CD  				=  </parts><bind id="BIND_BUMON_CD" /><parts>
					AND		MDCT0010.BAIHENSAGYOKAISI_YMD	=  </parts><bind id="BIND_BAIHENSAGYOKAISI_YMD" /><parts>
					AND		MDCT0010.BAIHEN_RIYTU 			=  </parts><bind id="BIND_BAIHEN_RIYTU" /><parts>
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" /><parts>
					AND		NOT EXISTS(
							SELECT 1 FROM MDCT0040
							WHERE
									MDCT0040.TENPO_CD			= MDCT0010.TENPO_CD
							AND		MDCT0040.BAIHENKAISI_YMD	= MDCT0010.BAIHENKAISI_YMD
							AND		MDCT0040.BAIHEN_NO			= MDCT0010.BAIHEN_NO
							AND		MDCT0040.BAIHENGYO_NO		= MDCT0010.BAIHENGYO_NO
							AND		MDCT0040.JISYA_HBN			= MDCT0010.JISYA_HBN
							AND		MDCT0040.IRO_CD				= MDCT0010.IRO_CD
					)
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 事前売変データTBL登録-->
		<sql id="TL030P01-08">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0040 (
							 TENPO_CD			/*  1 店舗コード */
							,BAIHENKAISI_YMD	/*  2 売変開始日 */
							,BAIHENSYURYO_YMD	/*  3 売変終了日 */
							,BAIHEN_NO			/*  4 売変№  */
							,BAIHENGYO_NO		/*  5 売変行№ */
							,JISYA_HBN			/*  6 自社品番 */
							,IRO_CD				/*  7 色コード */
							,GENBAIKA_TNK		/*  8 現売価 */
							,SIJIBAIKA_TNK		/*  9 指示売価 */
							,ADD_YMD			/* 10 登録日 */
							,ADD_TM				/* 11 登録時間 */
							,ADDTAN_CD			/* 12 登録担当者コード */
							,UPD_YMD			/* 13 更新日 */
							,UPD_TM				/* 14 更新時間 */
							,UPD_TANCD			/* 15 更新担当者コード */
							,SAKUJYO_YMD		/* 16 削除日 */
							,SAKUJYO_FLG		/* 17 削除フラグ */
							,SOSINIRAI_FLG		/* 18 送信依頼フラグ */
							,SOSINZUMI_FLG		/* 19 送信済フラグ */
							,SOSIN_YMD			/* 20 送信日 */
							,SOSIN_TM			/* 21 送信時間 */
					) SELECT
							 MDCT0010.TENPO_CD								/*  1 店舗コード */
							,MDCT0010.BAIHENKAISI_YMD						/*  2 売変開始日 */
							,MDCT0010.BAIHENSYURYO_YMD						/*  3 売変終了日 */
							,MDCT0010.BAIHEN_NO								/*  4 売変№  */
							,MDCT0010.BAIHENGYO_NO							/*  5 売変行№ */
							,MDCT0010.JISYA_HBN								/*  6 自社品番 */
							,MDCT0010.IRO_CD								/*  7 色コード */
							,MDCT0010.GENBAIKA_TNK							/*  8 現売価 */
							,MDCT0010.SIJIBAIKA_TNK							/*  9 指示売価 */
							,</parts><bind id="BIND_ADD_YMD" /><parts>		/* 10 登録日 */
							,</parts><bind id="BIND_ADD_TM" /><parts>		/* 11 登録時間 */
							,</parts><bind id="BIND_ADD_TANCD" /><parts>	/* 12 登録担当者コード */
							,</parts><bind id="BIND_UPD_YMD" /><parts>		/* 13 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>		/* 14 更新時間 */
							,</parts><bind id="BIND_UPD_TANCD" /><parts>	/* 15 更新担当者コード */
							,</parts><bind id="BIND_DEL_YMD" /><parts>		/* 16 削除日 */
							,0												/* 17 削除フラグ */
							,1												/* 18 送信依頼フラグ */
							,0												/* 19 送信済フラグ */
							,0												/* 20 送信日 */
							,0												/* 21 送信時間 */
					FROM
							MDCT0010			/* 売価変更指示TBL */
					WHERE
							EXISTS(
								SELECT 1
								FROM
										 MDMT0130
										,STMT0091
								WHERE
										MDMT0130.XEBIO_CD		= MDCT0010.JISYA_HBN
								AND		MDMT0130.MAKERCOLOR_CD	= MDCT0010.IRO_CD
								AND		STMT0091.SOSIKI			= '0001'
								AND		STMT0091.TENCD			= </parts><bind id="BIND_TENPO_CD_01" /><parts>
								AND		STMT0091.SKU			= MDMT0130.JAN_CD
							)
					AND(	(MDCT0010.SIJIBAIKA_TNK	= MDCT0010.GENBAIKA_TNK
							AND	MDCT0010.ADD_KBN	= '1')
						OR	(MDCT0010.ADD_KBN		= '2')
					)
					AND 	MDCT0010.TENPO_CD			= </parts><bind id="BIND_TENPO_CD_02" /><parts>
					AND 	MDCT0010.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND 	MDCT0010.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND		((
								CASE
									WHEN MDCT0010.KAKUTEI_FLG = 0 THEN
										( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_04" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_05" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0))
									ELSE
										MDCT0010.ZAIKO_SU
								END > 0 AND MDCT0010.ADD_KBN = 1)
							OR (MDCT0010.ADD_KBN = 2)
							)
					AND		MDCT0010.BAIHEN_RIYTU			&lt;&gt; 3
					AND		MDCT0010.KAKUTEI_FLG			=  0
					AND		MDCT0010.BUMON_CD  				=  </parts><bind id="BIND_BUMON_CD" /><parts>
					AND		MDCT0010.BAIHENSAGYOKAISI_YMD	=  </parts><bind id="BIND_BAIHENSAGYOKAISI_YMD" /><parts>
					AND		MDCT0010.BAIHEN_RIYTU 			=  </parts><bind id="BIND_BAIHEN_RIYTU" /><parts>
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" /><parts>
					AND		NOT EXISTS(
							SELECT 1 FROM MDCT0040
							WHERE
									MDCT0040.TENPO_CD			= MDCT0010.TENPO_CD
							AND		MDCT0040.BAIHENKAISI_YMD	= MDCT0010.BAIHENKAISI_YMD
							AND		MDCT0040.BAIHEN_NO			= MDCT0010.BAIHEN_NO
							AND		MDCT0040.BAIHENGYO_NO		= MDCT0010.BAIHENGYO_NO
							AND		MDCT0040.JISYA_HBN			= MDCT0010.JISYA_HBN
							AND		MDCT0040.IRO_CD				= MDCT0010.IRO_CD
					)
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 店舗売変予定TBL更新-->
		<sql id="TL030P01-09">
			<statement type="final" name="final">
				<parts>
					UPDATE MDCT0010 SET	/* 売変指示 */
						 KAKUTEI_FLG      = 1											/* 確定フラグ */
						,UPD_YMD          = </parts><bind id="BIND_UPD_YMD" /><parts>	/* 更新日 */
						,UPD_TM           = </parts><bind id="BIND_UPD_TM" /><parts>	/* 更新時間 */
						,UPD_TANCD        = </parts><bind id="BIND_UPD_TANCD" /><parts>	/* 更新担当者コード */
						,SAKUJYO_YMD      = </parts><bind id="BIND_DEL_YMD" /><parts>	/* 削除日 */
						,ZAIKO_SU         = (	  NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
												+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
												+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0)
											 )
					WHERE
							EXISTS(
								SELECT 1
								FROM
										 MDMT0130
										,STMT0091
								WHERE
										MDMT0130.XEBIO_CD		= MDCT0010.JISYA_HBN
								AND		MDMT0130.MAKERCOLOR_CD	= MDCT0010.IRO_CD
								AND		STMT0091.SOSIKI			= '0001'
								AND		STMT0091.TENCD			= </parts><bind id="BIND_TENPO_CD_04" /><parts>
								AND		STMT0091.SKU			= MDMT0130.JAN_CD
							)
					AND(	(MDCT0010.SIJIBAIKA_TNK	= MDCT0010.GENBAIKA_TNK
							AND	MDCT0010.ADD_KBN	= '1')
						OR	(MDCT0010.ADD_KBN		= '2')
					)
					AND 	MDCT0010.TENPO_CD			= </parts><bind id="BIND_TENPO_CD_05" /><parts>
					AND 	MDCT0010.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND 	MDCT0010.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND		((
								CASE
									WHEN MDCT0010.KAKUTEI_FLG = 0 THEN
										( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_06" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_07" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
										+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_08" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0))
									ELSE
										MDCT0010.ZAIKO_SU
								END > 0 AND MDCT0010.ADD_KBN = 1)
							OR (MDCT0010.ADD_KBN = 2)
							)
					AND		MDCT0010.BAIHEN_RIYTU			&lt;&gt; 3
					AND		MDCT0010.KAKUTEI_FLG			=  0
					AND		MDCT0010.BUMON_CD  				=  </parts><bind id="BIND_BUMON_CD" /><parts>
					AND		MDCT0010.BAIHENSAGYOKAISI_YMD	=  </parts><bind id="BIND_BAIHENSAGYOKAISI_YMD" /><parts>
					AND		MDCT0010.BAIHEN_RIYTU 			=  </parts><bind id="BIND_BAIHEN_RIYTU" /><parts>
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" /><parts>
					AND		NOT EXISTS(
							SELECT 1 FROM MDCT0030
							WHERE
									MDCT0030.TENPO_CD			= MDCT0010.TENPO_CD
							AND		MDCT0030.BAIHENKAISI_YMD	= MDCT0010.BAIHENKAISI_YMD
							AND		MDCT0030.BAIHEN_NO			= MDCT0010.BAIHEN_NO
							AND		MDCT0030.BAIHENGYO_NO		= MDCT0010.BAIHENGYO_NO
							AND		MDCT0030.JISYA_HBN			= MDCT0010.JISYA_HBN
							AND		MDCT0030.IRO_CD				= MDCT0010.IRO_CD
					)
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 店舗売変確定TBL登録 -->
		<sql id="TL030P01-10">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030 (	/* 売変確定 */
						 TENPO_CD			  /* 店舗コード */
						,BAIHENKAISI_YMD	  /* 売変開始日 */
						,BAIHENSYURYO_YMD	  /* 売変終了日 */
						,BAIHEN_NO		  /* 売変№  */
						,BAIHENGYO_NO		  /* 売変行№ */
						,BUMON_CD			  /* 部門コード */
						,HINSYU_CD			  /* 品種コード */
						,BURANDO_CD 		  /* ブランドコード */
						,MAKER_HBN			  /* メーカー品番 */
						,SYONMK 			  /* 商品名(カナ) */
						,JISYA_HBN			  /* 自社品番 */
						,IRO_CD 			  /* 色コード */
						,SEASON_KB			  /* シーズン */
						,JODAI1_TNK 		  /* 上代1 */
						,GENBAIKA_TNK		  /* 現売価 */
						,GEN_TNK			  /* 原単価 */
						,SIJIBAIKA_TNK		  /* 指示売価 */
						,KAKUTEIBAIKA_TNK	  /* 確定売価 */
						,ZAIKO_SU			  /* 在庫数 */
						,URIAGE_SU			  /* 売上数 */
						,HANDLBL_KB 		  /* ハンドラベル */
						,SYONIN_FLG			  /* 承認状態 */
						,SINSEITAN_CD		  /* 申請担当者コード */
						,KAKUTEITAN_CD		  /* 確定担当者コード */
						,ADD_YMD			  /* 登録日 */
						,ADD_TM 			  /* 登録時間 */
						,ADDTAN_CD			  /* 登録担当者コード */
						,UPD_YMD			  /* 更新日 */
						,UPD_TM 			  /* 更新時間 */
						,UPD_TANCD			  /* 更新担当者コード */
						,SAKUJYO_YMD		  /* 削除日 */
						,SAKUJYO_FLG		  /* 削除フラグ */
						,SOSINIRAI_FLG		  /* 送信依頼フラグ */
						,SOSINZUMI_FLG		  /* 送信済フラグ */
						,SOSIN_YMD			  /* 送信日 */
						,SOSIN_TM			  /* 送信時間 */
						,HHTSERIAL_NO		  /* HHTシリアル番号 */
						,HHTSEQUENCE_NO 	  /* HHTシーケンスNo. */
					) SELECT
						 MDCT0020.TENPO_CD																	/* 店舗コード */
						,MDCT0020.BAIHENKAISI_YMD															/* 売変開始日 */
						,MDCT0020.BAIHENSYURYO_YMD															/* 売変終了日 */
						,MDCT0020.BAIHEN_NO 																/* 売変№  */
						,MDCT0020.BAIHENGYO_NO																/* 売変行№ */
						,MDCT0020.BUMON_CD																	/* 部門コード */
						,MDCT0020.HINSYU_CD 																/* 品種コード */
						,MDCT0020.BURANDO_CD																/* ブランドコード */
						,MDCT0020.MAKER_HBN 																/* メーカー品番 */
						,MDCT0020.SYONMK																	/* 商品名(カナ) */
						,MDCT0020.JISYA_HBN 																/* 自社品番 */
						,MDCT0020.IRO_CD																	/* 色コード */
						,MDCT0020.SEASON_KB 																/* シーズン */
						,MDCT0020.JODAI1_TNK																/* 上代1 */
						,MIN(CASE WHEN STMT0091.SLPR IS NULL THEN MDMT0130.SLPR ELSE STMT0091.SLPR END)		/* 現売価 */
						,MDCT0020.GEN_TNK																	/* 原単価 */
						,MDCT0020.SIJIBAIKA_TNK 															/* 指示売価 */
						,MDCT0020.SIJIBAIKA_TNK 															/* 確定売価 */
						,( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0020.IRO_CD), 0)
						 + NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0020.IRO_CD), 0)
						 + NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0020.IRO_CD), 0))
						,MDCT0020.URIAGE_SU 																/* 売上数 */
						,MDCT0020.HANDLBL_KB																/* ハンドラベル */
						,1																					/* 承認状態 */
						,MDCT0020.SINSEITAN_CD																/* 申請担当者コード */
						,</parts><bind id="BIND_KAKUTEI_TANCD" /><parts>									/* 確定担当者コード */
						,</parts><bind id="BIND_ADD_YMD" /><parts>											/* 登録日 */
						,</parts><bind id="BIND_ADD_TM" /><parts>											/* 登録時間 */
						,</parts><bind id="BIND_ADD_TANCD" /><parts>										/* 登録担当者コード */
						,</parts><bind id="BIND_UPD_YMD" /><parts>											/* 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>											/* 更新時間 */
						,</parts><bind id="BIND_UPD_TANCD" /><parts>										/* 更新担当者コード */
						,</parts><bind id="BIND_DEL_YMD" /><parts>											/* 削除日 */
						,1																					/* 削除フラグ */
						,1																					/* 送信依頼フラグ */
						,0																					/* 送信済フラグ */
						,0																					/* 送信日 */
						,0																					/* 送信時間 */
						,MDCT0020.HHTSERIAL_NO																/* HHTシリアル番号 */
						,MDCT0020.HHTSEQUENCE_NO															/* HHTシーケンスNo. */
					FROM
						 MDCT0020	/* 売変予定 */
						,MDMT0130	/* 発注マスタ */
						,STMT0091	/* 店別単価 */
					WHERE
						MDCT0020.TENPO_CD			= </parts><bind id="BIND_TENPO_CD_04" /><parts>
					AND	MDCT0020.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND	MDCT0020.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND	MDCT0020.BUMON_CD			= </parts><bind id="BIND_BUMON_CD" /><parts>
					AND	MDCT0020.JISYA_HBN	   = MDMT0130.XEBIO_CD
					AND	STMT0091.SKU		   = MDMT0130.JAN_CD
					AND	MDMT0130.MAKERCOLOR_CD = MDCT0020.IRO_CD
					AND	STMT0091.SOSIKI 	   = '0001'
					AND	STMT0091.TENCD		   = </parts><bind id="BIND_TENPO_CD_05" /><parts>
					AND	NOT EXISTS (
						SELECT 1
						FROM
							MDCT0030
						WHERE
							MDCT0030.TENPO_CD		 = MDCT0020.TENPO_CD
						AND	MDCT0030.BAIHENKAISI_YMD = MDCT0020.BAIHENKAISI_YMD
						AND	MDCT0030.BAIHEN_NO		 = MDCT0020.BAIHEN_NO
						AND	MDCT0030.BAIHENGYO_NO	 = MDCT0020.BAIHENGYO_NO
						AND	MDCT0030.JISYA_HBN		 = MDCT0020.JISYA_HBN
						AND	MDCT0030.IRO_CD 	  = MDCT0020.IRO_CD
					)
					AND	MDCT0020.SIJIBAIKA_TNK &lt;&gt; MDCT0020.GENBAIKA_TNK
					GROUP BY
						 MDCT0020.TENPO_CD			   /* 店舗コード */
						,MDCT0020.BAIHENKAISI_YMD	   /* 売変開始日 */
						,MDCT0020.BAIHENSYURYO_YMD	   /* 売変終了日 */
						,MDCT0020.BAIHEN_NO 		   /* 売変№  */
						,MDCT0020.BAIHENGYO_NO		   /* 売変行№ */
						,MDCT0020.BUMON_CD			   /* 部門コード */
						,MDCT0020.HINSYU_CD 		   /* 品種コード */
						,MDCT0020.BURANDO_CD		   /* ブランドコード */
						,MDCT0020.MAKER_HBN 		   /* メーカー品番 */
						,MDCT0020.SYONMK			   /* 商品名(カナ) */
						,MDCT0020.JISYA_HBN 		   /* 自社品番 */
						,MDCT0020.IRO_CD			   /* 色コード */
						,MDCT0020.SEASON_KB 		   /* シーズン */
						,MDCT0020.JODAI1_TNK		   /* 上代1 */
						,MDCT0020.GEN_TNK			   /* 原単価 */
						,MDCT0020.SIJIBAIKA_TNK 	   /* 指示売価 */
						,MDCT0020.SIJIBAIKA_TNK 	   /* 確定売価 */
						,MDCT0020.ZAIKO_SU			   /* 在庫数 */
						,MDCT0020.URIAGE_SU 		   /* 売上数 */
						,MDCT0020.HANDLBL_KB		   /* ハンドラベル */
						,MDCT0020.SINSEITAN_CD		   /* 申請担当者コード */
						,MDCT0020.HHTSERIAL_NO		   /* HHTシリアル番号 */
						,MDCT0020.HHTSEQUENCE_NO	   /* HHTシーケンスNo. */
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 店舗売変確定TBL登録 (カラー管理商品用）-->
		<sql id="TL030P01-11">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030 (									/* 売変確定 */
						 TENPO_CD											/* 店舗コード */
						,BAIHENKAISI_YMD									/* 売変開始日 */
						,BAIHENSYURYO_YMD									/* 売変終了日 */
						,BAIHEN_NO											/* 売変№  */
						,BAIHENGYO_NO										/* 売変行№ */
						,BUMON_CD											/* 部門コード */
						,HINSYU_CD											/* 品種コード */
						,BURANDO_CD											/* ブランドコード */
						,MAKER_HBN											/* メーカー品番 */
						,SYONMK												/* 商品名(カナ) */
						,JISYA_HBN											/* 自社品番 */
						,IRO_CD												/* 色コード */
						,SEASON_KB											/* シーズン */
						,JODAI1_TNK											/* 上代1 */
						,GENBAIKA_TNK										/* 現売価 */
						,GEN_TNK											/* 原単価 */
						,SIJIBAIKA_TNK										/* 指示売価 */
						,KAKUTEIBAIKA_TNK									/* 確定売価 */
						,ZAIKO_SU											/* 在庫数 */
						,URIAGE_SU											/* 売上数 */
						,HANDLBL_KB											/* ハンドラベル */
						,SYONIN_FLG											/* 承認状態 */
						,SINSEITAN_CD										/* 申請担当者コード */
						,KAKUTEITAN_CD										/* 確定担当者コード */
						,ADD_YMD											/* 登録日 */
						,ADD_TM												/* 登録時間 */
						,ADDTAN_CD											/* 登録担当者コード */
						,UPD_YMD											/* 更新日 */
						,UPD_TM												/* 更新時間 */
						,UPD_TANCD											/* 更新担当者コード */
						,SAKUJYO_YMD										/* 削除日 */
						,SAKUJYO_FLG										/* 削除フラグ */
						,SOSINIRAI_FLG										/* 送信依頼フラグ */
						,SOSINZUMI_FLG										/* 送信済フラグ */
						,SOSIN_YMD											/* 送信日 */
						,SOSIN_TM											/* 送信時間 */
						,HHTSERIAL_NO										/* HHTシリアル番号 */
						,HHTSEQUENCE_NO										/* HHTシーケンスNo. */
					) SELECT
						 MDCT0020.TENPO_CD									/* 店舗コード */
						,MDCT0020.BAIHENKAISI_YMD							/* 売変開始日 */
						,MDCT0020.BAIHENSYURYO_YMD							/* 売変終了日 */
						,MDCT0020.BAIHEN_NO									/* 売変№  */
						,MDCT0020.BAIHENGYO_NO								/* 売変行№ */
						,MDCT0020.BUMON_CD									/* 部門コード */
						,MDCT0020.HINSYU_CD									/* 品種コード */
						,MDCT0020.BURANDO_CD								/* ブランドコード */
						,MDCT0020.MAKER_HBN									/* メーカー品番 */
						,MDCT0020.SYONMK									/* 商品名(カナ) */
						,MDCT0020.JISYA_HBN									/* 自社品番 */
						,MDCT0020.IRO_CD									/* 色コード */
						,MDCT0020.SEASON_KB									/* シーズン */
						,MDCT0020.JODAI1_TNK								/* 上代1 */
						,MIN(MDMT0130.SLPR)									/* 現売価 */
						,MDCT0020.GEN_TNK									/* 原単価 */
						,MDCT0020.SIJIBAIKA_TNK								/* 指示売価 */
						,MDCT0020.SIJIBAIKA_TNK								/* 確定売価 */
						,( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0020.IRO_CD), 0)
						 + NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0020.IRO_CD), 0)
						 + NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0020.IRO_CD), 0))
						,MDCT0020.URIAGE_SU									/* 売上数 */
						,MDCT0020.HANDLBL_KB								/* ハンドラベル */
						,1													/* 承認状態 */
						,MDCT0020.SINSEITAN_CD								/* 申請担当者コード */
						,</parts><bind id="BIND_KAKUTEI_TANCD" /><parts>	/* 確定担当者コード */
						,</parts><bind id="BIND_ADD_YMD" /><parts>			/* 登録日 */
						,</parts><bind id="BIND_ADD_TM" /><parts>			/* 登録時間 */
						,</parts><bind id="BIND_ADD_TANCD" /><parts>		/* 登録担当者コード */
						,</parts><bind id="BIND_UPD_YMD" /><parts>			/* 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>			/* 更新時間 */
						,</parts><bind id="BIND_UPD_TANCD" /><parts>		/* 更新担当者コード */
						,</parts><bind id="BIND_DEL_YMD" /><parts>			/* 削除日 */
						,1													/* 削除フラグ */
						,1													/* 送信依頼フラグ */
						,0													/* 送信済フラグ */
						,0													/* 送信日 */
						,0													/* 送信時間 */
						,MDCT0020.HHTSERIAL_NO								/* HHTシリアル番号 */
						,MDCT0020.HHTSEQUENCE_NO							/* HHTシーケンスNo. */
					FROM
						 MDCT0020											/* 売変予定 */
						,MDMT0130											/* 発注マスタ */
					WHERE
						MDCT0020.TENPO_CD			= </parts><bind id="BIND_TENPO_CD_04" /><parts>
					AND	MDCT0020.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND	MDCT0020.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND	MDCT0020.BUMON_CD			= </parts><bind id="BIND_BUMON_CD" /><parts>
					AND	MDCT0020.JISYA_HBN			= MDMT0130.XEBIO_CD
					AND	MDMT0130.MAKERCOLOR_CD		= MDCT0020.IRO_CD
					AND	NOT EXISTS (
						SELECT 1
						FROM
							MDCT0030
						WHERE
							MDCT0030.TENPO_CD			= MDCT0020.TENPO_CD
						AND	MDCT0030.BAIHENKAISI_YMD	= MDCT0020.BAIHENKAISI_YMD
						AND	MDCT0030.BAIHEN_NO			= MDCT0020.BAIHEN_NO
						AND	MDCT0030.BAIHENGYO_NO		= MDCT0020.BAIHENGYO_NO
						AND	MDCT0030.JISYA_HBN			= MDCT0020.JISYA_HBN
					)
					AND	MDMT0130.TENKAI_KB = 2	-- カラー展開
					AND	MDMT0130.OLD_XEBIO_CD &lt;&gt; '0000000000'
					GROUP BY
						 MDCT0020.TENPO_CD				/* 店舗コード */
						,MDCT0020.BAIHENKAISI_YMD		/* 売変開始日 */
						,MDCT0020.BAIHENSYURYO_YMD		/* 売変終了日 */
						,MDCT0020.BAIHEN_NO				/* 売変№  */
						,MDCT0020.BAIHENGYO_NO			/* 売変行№ */
						,MDCT0020.BUMON_CD				/* 部門コード */
						,MDCT0020.HINSYU_CD				/* 品種コード */
						,MDCT0020.BURANDO_CD			/* ブランドコード */
						,MDCT0020.MAKER_HBN				/* メーカー品番 */
						,MDCT0020.SYONMK				/* 商品名(カナ) */
						,MDCT0020.JISYA_HBN				/* 自社品番 */
						,MDCT0020.IRO_CD				/* 色コード */
						,MDCT0020.SEASON_KB				/* シーズン */
						,MDCT0020.JODAI1_TNK			/* 上代1 */
						,MDCT0020.GEN_TNK				/* 原単価 */
						,MDCT0020.SIJIBAIKA_TNK			/* 指示売価 */
						,MDCT0020.SIJIBAIKA_TNK			/* 確定売価 */
						,MDCT0020.ZAIKO_SU				/* 在庫数 */
						,MDCT0020.URIAGE_SU				/* 売上数 */
						,MDCT0020.HANDLBL_KB			/* ハンドラベル */
						,MDCT0020.SINSEITAN_CD			/* 申請担当者コード */
						,MDCT0020.HHTSERIAL_NO			/* HHTシリアル番号 */
						,MDCT0020.HHTSEQUENCE_NO		/* HHTシーケンスNo. */
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 売変確定一時TBL登録-->
		<sql id="TL030P01-12">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030_TEMP (
						 BAIHEN_NO									/* 売変NO */
						,TENPO_CD									/* 店舗コード */
						,JISYA_HBN									/* 自社品番 */
						,IRO_CD 									/* 色コード */
						,KAKUTEIBAIKA_TNK							/* 確定売価 */
						,UPD_YMD									/* 更新日 */
						,UPD_TM 									/* 更新時間 */
					) SELECT
						 MDCT0030.BAIHEN_NO 						/* 売変NO */
						,MDCT0030.TENPO_CD							/* 店舗コード */
						,MDCT0030.JISYA_HBN 						/* 自社品番 */
						,MDCT0030.IRO_CD							/* 色コード */
						,MDCT0030.KAKUTEIBAIKA_TNK					/* 確定売価 */
						,MDCT0030.UPD_YMD							/* 更新日 */
						,SUBSTR(LPAD(MDCT0030.UPD_TM,9,'0'),0,6)	/* 更新時間 */
					FROM
						MDCT0030	/* 売変確定 */
					WHERE
						MDCT0030.TENPO_CD			= </parts><bind id="BIND_TENPO_CD" /><parts>
					AND	MDCT0030.BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND	MDCT0030.BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND	MDCT0030.BUMON_CD			= </parts><bind id="BIND_BUMON_CD" /><parts>
					AND	MDCT0030.UPD_YMD			= </parts><bind id="BIND_UPD_YMD" /><parts>
					AND	MDCT0030.UPD_TM				= </parts><bind id="BIND_UPD_TM" /><parts>
					AND NOT EXISTS (
						SELECT 1 FROM MDCT0030_TEMP
						WHERE
							MDCT0030.BAIHEN_NO		= MDCT0030_TEMP.BAIHEN_NO
						AND	MDCT0030.TENPO_CD		= MDCT0030_TEMP.TENPO_CD
						AND	MDCT0030.JISYA_HBN		= MDCT0030_TEMP.JISYA_HBN
						AND	MDCT0030.IRO_CD 		= MDCT0030_TEMP.IRO_CD
						AND	MDCT0030.KAKUTEIBAIKA_TNK= MDCT0030_TEMP.KAKUTEIBAIKA_TNK
						AND	MDCT0030.UPD_YMD		= MDCT0030_TEMP.UPD_YMD
					)
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 店舗売変予定TBL更新-->
		<sql id="TL030P01-13">
			<statement type="final" name="final">
				<parts>
					UPDATE MDCT0020 SET														/* 売変予定 */
						 KAKUTEI_FLG	  = 1												/* 確定フラグ */
						,UPD_YMD		  = </parts><bind id="BIND_UPD_YMD_01" /><parts>	/* 更新日 */
						,UPD_TM 		  = </parts><bind id="BIND_UPD_TM_01" /><parts>		/* 更新時間 */
						,UPD_TANCD		  = </parts><bind id="BIND_UPD_TANCD" /><parts>		/* 更新担当者コード */
						,SAKUJYO_YMD	  = </parts><bind id="BIND_DEL_YMD" /><parts>		/* 削除日 */
						,SAKUJYO_FLG	  = 1
					WHERE EXISTS (
						SELECT 1
						FROM
							MDCT0030	/* 売変確定 */
						WHERE
							MDCT0030.TENPO_CD		 = MDCT0020.TENPO_CD
						AND	MDCT0030.BAIHENKAISI_YMD = MDCT0020.BAIHENKAISI_YMD
						AND	MDCT0030.BAIHEN_NO		 = MDCT0020.BAIHEN_NO
						AND	MDCT0030.BAIHENGYO_NO	 = MDCT0020.BAIHENGYO_NO
						AND	MDCT0030.UPD_YMD		 = </parts><bind id="BIND_UPD_YMD_02" /><parts>		/* 更新日 */
						AND	MDCT0030.UPD_TM 		 = </parts><bind id="BIND_UPD_TM_02" /><parts>		/* 更新時間 */
					)
					AND	TENPO_CD		  = </parts><bind id="BIND_TENPO_CD" /><parts>				/* 店舗コード */
					AND	BAIHENKAISI_YMD   = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/* 売変開始日 */
					AND	BAIHEN_NO		  = </parts><bind id="BIND_BAIHEN_NO" /><parts>				/* 売変No */
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 店別単価MST更新-->
		<sql id="TL030P01-14">
			<statement type="final" name="final">
				<parts>
					UPDATE STMT0091 SET
						(
							 SLPR		/* 標準単価 */
							,UPDYMD		/* 更新日時 */
							,UPDHMS		/* 更新時刻 */
						) = (
							SELECT
								 KAKUTEIBAIKA_TNK	/* 標準単価 */
								,UPD_YMD			/* 日付 */
								,UPD_TM				/* 時刻 */
							FROM (
									SELECT
											 STMT0090.SOSIKI				/* STMT0090．SOSIKI */
											,STMT0090.SKU					/* STMT0090．SKU */
											,MDCT0030_TEMP.TENPO_CD			/* 一時テーブル．店舗コード */
											,MDCT0030_TEMP.IRO_CD			/* 一時テーブル．色コード */
											,MDCT0030_TEMP.KAKUTEIBAIKA_TNK	/* 一時テーブル．標準単価 */
											,MDCT0030_TEMP.UPD_YMD			/* 一時テーブル．日付 */
											,MDCT0030_TEMP.UPD_TM			/* 一時テーブル．時刻 */
									FROM
											 STMT0090		/* 共通PLU */
											,(
												SELECT
													BAIHEN_NO, TENPO_CD, JISYA_HBN, IRO_CD, KAKUTEIBAIKA_TNK,UPD_YMD, UPD_TM
												FROM
													MDCT0030_TEMP	/* 一時テーブル */
												GROUP BY
													BAIHEN_NO, TENPO_CD, JISYA_HBN, IRO_CD, KAKUTEIBAIKA_TNK,UPD_YMD, UPD_TM
											) MDCT0030_TEMP
									WHERE
											STMT0090.SOSIKI   = '0001'
									AND		STMT0090.TENCD    = '0000'
									AND		STMT0090.XEBIO_CD_NEW  = MDCT0030_TEMP.JISYA_HBN
									AND		STMT0090.MAKERCOLOR_CD = MDCT0030_TEMP.IRO_CD
									AND		(MDCT0030_TEMP.BAIHEN_NO, MDCT0030_TEMP.TENPO_CD, MDCT0030_TEMP.JISYA_HBN, MDCT0030_TEMP.IRO_CD) IN (
													SELECT		MAX(BAIHEN_NO), TENPO_CD, JISYA_HBN, IRO_CD
													FROM		MDCT0030_TEMP	/* 一時テーブル① */
													GROUP BY	MDCT0030_TEMP.TENPO_CD, MDCT0030_TEMP.JISYA_HBN, MDCT0030_TEMP.IRO_CD
											)
								) A
							WHERE
									STMT0091.SOSIKI = A.SOSIKI
							AND		STMT0091.TENCD  = A.TENPO_CD
							AND		STMT0091.SKU    = A.SKU
						)
					WHERE 
						(
							 STMT0091.SOSIKI
							,STMT0091.SKU
							,STMT0091.TENCD 
						) IN (
							SELECT
									 STMT0090.SOSIKI				/* STMT0090．SOSIKI */
									,STMT0090.SKU					/* STMT0090．SKU */
									,MDCT0030_TEMP.TENPO_CD			/* 一時テーブル．店舗コード */
							FROM
									 STMT0090		/* 共通PLU */
									,(
										SELECT
											BAIHEN_NO, TENPO_CD, JISYA_HBN, IRO_CD, KAKUTEIBAIKA_TNK,UPD_YMD, UPD_TM
										FROM
											MDCT0030_TEMP	/* 一時テーブル */
										GROUP BY
											BAIHEN_NO, TENPO_CD, JISYA_HBN, IRO_CD, KAKUTEIBAIKA_TNK,UPD_YMD, UPD_TM
									) MDCT0030_TEMP
							WHERE
									STMT0090.SOSIKI   = '0001'
							AND		STMT0090.TENCD    = '0000'
							AND		STMT0090.XEBIO_CD_NEW  = MDCT0030_TEMP.JISYA_HBN
							AND		STMT0090.MAKERCOLOR_CD = MDCT0030_TEMP.IRO_CD

						)
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 一覧 確定 売変確定ワーク削除-->
		<sql id="TL030P01-15">
			<statement type="final" name="final">
				<parts>
					DELETE FROM W_MDCT0030 W1
					WHERE	W1.SEQ = </parts><bind id="BIND_SEQ" /><parts>
					AND		W1.UPD_TANCD = </parts><bind id="BIND_TANCD" />
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 売変期間チェック-->
		<sql id="TL030P01-16">
			<statement type="final" name="final">
				<parts>
					SELECT
							 COUNT(1) CNT
					FROM MDCT0010		/* 売変指示 */
					WHERE	0=0
					AND	MDCT0010.KAKUTEI_FLG = 0
				</parts>
			</statement>
			<statement type="replace" name="WHERE_01"/>
		</sql>

		<!--売変確定(X) 明細 確定 売価変更指示TBL 更新-->
		<sql id="TL030P01-17">
			<statement type="final" name="final">
				<parts>
						UPDATE MDCT0010 SET	/* 売変指示 */
							 KAKUTEI_FLG      = 1												/* 確定フラグ */
							,UPD_YMD          = </parts><bind id="BIND_UPD_YMD" /><parts>		/* 更新日 */
							,UPD_TM           = </parts><bind id="BIND_UPD_TM" /><parts>		/* 更新時間 */
							,UPD_TANCD        = </parts><bind id="BIND_UPD_TANCD" /><parts>		/* 更新担当者コード */
							,SAKUJYO_YMD      = </parts><bind id="BIND_DEL_YMD" /><parts>		/* 削除日 */
							,ZAIKO_SU         = (	  NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0010.IRO_CD), 0)
													+ NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0010.IRO_CD), 0)
													+ NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0010.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0010.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0010.IRO_CD), 0)
												 )
						WHERE 
							TENPO_CD          = </parts><bind id="BIND_TENPO_CD_04" /><parts>							/* 店舗コード */
						AND	BAIHENKAISI_YMD   = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>						/* 売変開始日 */
						AND	BAIHEN_NO         = </parts><bind id="BIND_BAIHEN_NO" /><parts>								/* 売変No */
						AND	BAIHENGYO_NO      = CASE WHEN </parts><bind id="BIND_IRO_CD_01" /><parts> = ' ' THEN BAIHENGYO_NO ELSE </parts><bind id="BIND_BAIHENGYO_NO" /><parts> END
																														/* 売変行No */
						AND	JISYA_HBN         = </parts><bind id="BIND_JISYA_HBN" /><parts>								/* 自社品番 */
						AND	IRO_CD            = CASE WHEN </parts><bind id="BIND_IRO_CD_02" /><parts> = ' ' THEN IRO_CD ELSE </parts><bind id="BIND_IRO_CD_03" /><parts> END
																														/* 色コード */
						AND	(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" />
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 事前売変データ存在チェック-->
		<sql id="TL030P01-18">
			<statement type="final" name="final">
				<parts>
					SELECT
							COUNT(1) CNT
					FROM
							MDCT0040
					WHERE
							TENPO_CD		= </parts><bind id="BIND_TENPO_CD" /><parts>			/*  1 店舗コード */
					AND		BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/*  2 売変開始日 */
					AND		BAIHEN_NO		= </parts><bind id="BIND_BAIHEN_NO" /><parts>			/*  4 売変№  */
					AND		BAIHENGYO_NO	= </parts><bind id="BIND_BAIHENGYO_NO" /><parts>		/*  5 売変行№ */
					AND		JISYA_HBN		= </parts><bind id="BIND_JISYA_HBN" /><parts>			/*  6 自社品番 */
					AND		IRO_CD			= CASE WHEN </parts><bind id="BIND_IRO_CD_01" /><parts> = ' ' THEN IRO_CD ELSE </parts><bind id="BIND_IRO_CD_02" /><parts> END
																									/*  7 色コード */
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 事前売変データTBL登録-->
		<sql id="TL030P01-19">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0040 (
						 TENPO_CD				/*  1 店舗コード */
						,BAIHENKAISI_YMD		/*  2 売変開始日 */
						,BAIHENSYURYO_YMD		/*  3 売変終了日 */
						,BAIHEN_NO				/*  4 売変№  */
						,BAIHENGYO_NO			/*  5 売変行№ */
						,JISYA_HBN				/*  6 自社品番 */
						,IRO_CD					/*  7 色コード */
						,GENBAIKA_TNK			/*  8 現売価 */
						,SIJIBAIKA_TNK			/*  9 指示売価 */
						,ADD_YMD				/* 10 登録日 */
						,ADD_TM					/* 11 登録時間 */
						,ADDTAN_CD				/* 12 登録担当者コード */
						,UPD_YMD				/* 13 更新日 */
						,UPD_TM					/* 14 更新時間 */
						,UPD_TANCD				/* 15 更新担当者コード */
						,SAKUJYO_YMD			/* 16 削除日 */
						,SAKUJYO_FLG			/* 17 削除フラグ */
						,SOSINIRAI_FLG			/* 18 送信依頼フラグ */
						,SOSINZUMI_FLG			/* 19 送信済フラグ */
						,SOSIN_YMD				/* 20 送信日 */
						,SOSIN_TM				/* 21 送信時間 */
					) VALUES (
						 </parts><bind id="BIND_TENPO_CD" /><parts>				/*  1 店舗コード */
						,</parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/*  2 売変開始日 */
						,</parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts>		/*  3 売変終了日 */
						,</parts><bind id="BIND_BAIHEN_NO" /><parts>			/*  4 売変№  */
						,</parts><bind id="BIND_BAIHENGYO_NO" /><parts>			/*  5 売変行№ */
						,</parts><bind id="BIND_JISYA_HBN" /><parts>			/*  6 自社品番 */
						,</parts><bind id="BIND_IRO_CD" /><parts>				/*  7 色コード */
						,</parts><bind id="BIND_GENBAIKA_TNK" /><parts>			/*  8 現売価 */
						,</parts><bind id="BIND_SIJIBAIKA_TNK" /><parts>		/*  9 指示売価 */
						,</parts><bind id="BIND_ADD_YMD" /><parts>				/* 10 登録日 */
						,</parts><bind id="BIND_ADD_TM" /><parts>				/* 11 登録時間 */
						,</parts><bind id="BIND_ADD_TANCD" /><parts>			/* 12 登録担当者コード */
						,</parts><bind id="BIND_UPD_YMD" /><parts>				/* 13 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>				/* 14 更新時間 */
						,</parts><bind id="BIND_UPD_TANCD" /><parts>			/* 15 更新担当者コード */
						,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>			/* 16 削除日 */
						,0														/* 17 削除フラグ */
						,1														/* 18 送信依頼フラグ */
						,0														/* 19 送信済フラグ */
						,0														/* 20 送信日 */
						,0														/* 21 送信時間 */
					)
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 売変確定一時TBL登録	-->
		<sql id="TL030P01-20">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030_TEMP (
						 BAIHEN_NO				/*  4 売変NO */
						,TENPO_CD				/*  1 店舗コード */
						,JISYA_HBN				/*  6 自社品番 */
						,IRO_CD					/*  7 色コード */
						,KAKUTEIBAIKA_TNK		/* 22 確定売価 */
						,UPD_YMD				/* 13 更新日 */
						,UPD_TM					/* 14 更新時間 */
					) VALUES (
						</parts><bind id="BIND_BAIHEN_NO" /><parts>				/*  4 売変№  */
						,</parts><bind id="BIND_TENPO_CD" /><parts>				/*  1 店舗コード */
						,</parts><bind id="BIND_JISYA_HBN" /><parts>			/*  6 自社品番 */
						,</parts><bind id="BIND_IRO_CD" /><parts>				/*  7 色コード */
						,</parts><bind id="BIND_KAKUTEIBAIKA_TNK" /><parts>		/* 22 確定売価 */
						,</parts><bind id="BIND_UPD_YMD" /><parts>				/* 13 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>				/* 14 更新時間 */
					)
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 事前売変データTBL登録(カラー管理商品)	-->
		<sql id="TL030P01-21">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0040 (
							 TENPO_CD				/*  1 店舗コード */
							,BAIHENKAISI_YMD		/*  2 売変開始日 */
							,BAIHENSYURYO_YMD		/*  3 売変終了日 */
							,BAIHEN_NO				/*  4 売変№  */
							,BAIHENGYO_NO			/*  5 売変行№ */
							,JISYA_HBN				/*  6 自社品番 */
							,IRO_CD					/*  7 色コード */
							,GENBAIKA_TNK			/*  8 現売価 */
							,SIJIBAIKA_TNK			/*  9 指示売価 */
							,ADD_YMD				/* 10 登録日 */
							,ADD_TM					/* 11 登録時間 */
							,ADDTAN_CD				/* 12 登録担当者コード */
							,UPD_YMD				/* 13 更新日 */
							,UPD_TM					/* 14 更新時間 */
							,UPD_TANCD				/* 15 更新担当者コード */
							,SAKUJYO_YMD			/* 16 削除日 */
							,SAKUJYO_FLG			/* 17 削除フラグ */
							,SOSINIRAI_FLG			/* 18 送信依頼フラグ */
							,SOSINZUMI_FLG			/* 19 送信済フラグ */
							,SOSIN_YMD				/* 20 送信日 */
							,SOSIN_TM				/* 21 送信時間 */
					) SELECT
							 MDCT0010.TENPO_CD									/*  1 店舗コード */
							,MDCT0010.BAIHENKAISI_YMD							/*  2 売変開始日 */
							,MDCT0010.BAIHENSYURYO_YMD							/*  3 売変終了日 */
							,MDCT0010.BAIHEN_NO									/*  4 売変№  */
							,MDCT0010.BAIHENGYO_NO								/*  5 売変行№ */
							,</parts><bind id="BIND_JISYA_HBN_01" /><parts>		/*  6 自社品番 */
							,MDCT0010.IRO_CD									/*  7 色コード */
							,</parts><bind id="BIND_GENBAIKA_TNK" /><parts>		/*  8 現売価 */
							,</parts><bind id="BIND_SIJIBAIKA_TNK" /><parts>	/*  9 指示売価 */
							,</parts><bind id="BIND_ADD_YMD" /><parts>			/* 10 登録日 */
							,</parts><bind id="BIND_ADD_TM" /><parts>			/* 11 登録時間 */
							,</parts><bind id="BIND_ADD_TANCD" /><parts>		/* 12 登録担当者コード */
							,</parts><bind id="BIND_UPD_YMD" /><parts>			/* 13 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>			/* 14 更新時間 */
							,</parts><bind id="BIND_UPD_TANCD" /><parts>		/* 15 更新担当者コード */
							,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>		/* 16 削除日 */
							,0													/* 17 削除フラグ */
							,1													/* 18 送信依頼フラグ */
							,0													/* 19 送信済フラグ */
							,0													/* 20 送信日 */
							,0													/* 21 送信時間 */
					FROM
							MDCT0010
					WHERE
							TENPO_CD			= </parts><bind id="BIND_TENPO_CD" /><parts>			/*  1 店舗コード */
					AND		BAIHENKAISI_YMD		= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/*  2 売変開始日 */
					AND		BAIHENSYURYO_YMD	= </parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts>	/*  3 売変終了日 */
					AND		BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>			/*  4 売変№  */
					AND		JISYA_HBN			= </parts><bind id="BIND_JISYA_HBN_02" /><parts>			/*  6 自社品番 */
					AND		NOT EXISTS(
							SELECT 1 FROM MDCT0040
							WHERE
									MDCT0040.TENPO_CD			= MDCT0010.TENPO_CD
							AND		MDCT0040.BAIHENKAISI_YMD	= MDCT0010.BAIHENKAISI_YMD
							AND		MDCT0040.BAIHEN_NO			= MDCT0010.BAIHEN_NO
							AND		MDCT0040.BAIHENGYO_NO		= MDCT0010.BAIHENGYO_NO
							AND		MDCT0040.JISYA_HBN			= MDCT0010.JISYA_HBN
							AND		MDCT0040.IRO_CD				= MDCT0010.IRO_CD
					)
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" />
			</statement>
		</sql>
		<!--売変確定(X) 明細 確定 売変確定一時TBL登録(カラー管理商品)	-->
		<sql id="TL030P01-22">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030_TEMP (
							 BAIHEN_NO				/*  4 売変NO */
							,TENPO_CD				/*  1 店舗コード */
							,JISYA_HBN				/*  6 自社品番 */
							,IRO_CD					/*  7 色コード */
							,KAKUTEIBAIKA_TNK		/* 22 確定売価 */
							,UPD_YMD				/* 13 更新日 */
							,UPD_TM					/* 14 更新時間 */
					) SELECT
							 MDCT0010.BAIHEN_NO										/*  4 売変NO */
							,MDCT0010.TENPO_CD										/*  1 店舗コード */
							,</parts><bind id="BIND_JISYA_HBN_01" /><parts>			/*  6 自社品番 */
							,MDCT0010.IRO_CD										/*  7 色コード */
							,</parts><bind id="BIND_KAKUTEIBAIKA_TNK" /><parts>		/* 22 確定売価 */
							,</parts><bind id="BIND_UPD_YMD" /><parts>				/* 13 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>				/* 14 更新時間 */
					FROM
							MDCT0010
					WHERE
							TENPO_CD			= </parts><bind id="BIND_TENPO_CD" /><parts>			/*  1 店舗コード */
					AND		BAIHENKAISI_YMD		= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/*  2 売変開始日 */
					AND		BAIHENSYURYO_YMD	= </parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts>	/*  3 売変終了日 */
					AND		BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>			/*  4 売変№  */
					AND		JISYA_HBN			= </parts><bind id="BIND_JISYA_HBN_02" /><parts>		/*  6 自社品番 */
					AND		NOT EXISTS(
							SELECT 1 FROM MDCT0040
							WHERE
									MDCT0040.TENPO_CD			= MDCT0010.TENPO_CD
							AND		MDCT0040.BAIHENKAISI_YMD	= MDCT0010.BAIHENKAISI_YMD
							AND		MDCT0040.BAIHEN_NO			= MDCT0010.BAIHEN_NO
							AND		MDCT0040.BAIHENGYO_NO		= MDCT0010.BAIHENGYO_NO
							AND		MDCT0040.JISYA_HBN			= MDCT0010.JISYA_HBN
							AND		MDCT0040.IRO_CD				= MDCT0010.IRO_CD
					)
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" />
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 自動売変延長データTBL削除	-->
		<sql id="TL030P01-23">
			<statement type="final" name="final">
				<parts>
					DELETE MDCT0050
					WHERE
					    MDCT0050.TENPO_CD        = </parts><bind id="BIND_TENPO_CD" /><parts>				/* 店舗コード */
					AND MDCT0050.BAIHENKAISI_YMD = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/* 売変開始日 */
					AND MDCT0050.BAIHEN_NO       = </parts><bind id="BIND_BAIHEN_NO" /><parts>				/* 売変№ */
					AND MDCT0050.BAIHENGYO_NO       = </parts><bind id="BIND_BAIHENGYO_NO" /><parts>		/* 売変行№ */
					AND MDCT0050.JISYA_HBN       = </parts><bind id="BIND_JISYA_HBN" /><parts>				/* 自社品番 */
					AND MDCT0050.IRO_CD       = </parts><bind id="BIND_IRO_CD" /><parts>					/* 色コード */
					AND MDCT0050.SAKUJYO_FLG     = 0
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 明細 確定 自動売変延長データTBL登録	-->
		<sql id="TL030P01-24">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0050 (
						 TENPO_CD			  /* 店舗コード */
						,BAIHENKAISI_YMD	  /* 売変開始日 */
						,BAIHENSYURYO_YMD	  /* 売変終了日 */
						,BAIHEN_NO			  /* 売変№	*/
						,BAIHENGYO_NO		  /* 売変行№ */
						,JISYA_HBN			  /* 自社品番 */
						,IRO_CD 			  /* 色コード */
						,GENBAIKA_TNK		  /* 現売価 */
						,SYORI_YMD			  /* 処理日付 */
						,ADD_YMD			  /* 登録日 */
						,ADD_TM 			  /* 登録時間 */
						,ADDTAN_CD			  /* 登録担当者コード */
						,UPD_YMD			  /* 更新日 */
						,UPD_TM 			  /* 更新時間 */
						,UPD_TANCD			  /* 更新担当者コード */
						,SAKUJYO_YMD		  /* 削除日 */
						,SAKUJYO_FLG		  /* 削除フラグ */
						,SOSINIRAI_FLG		  /* 送信依頼フラグ */
						,SOSINZUMI_FLG		  /* 送信済フラグ */
						,SOSIN_YMD			  /* 送信日 */
						,SOSIN_TM			  /* 送信時間 */
					) VALUES (
						 </parts><bind id="BIND_TENPO_CD" /><parts> 			/* 店舗コード */
						,</parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/* 売変開始日 */
						,</parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts> 	/* 売変終了日 */
						,</parts><bind id="BIND_BAIHEN_NO" /><parts>			/* 売変№  */
						,</parts><bind id="BIND_BAIHENGYO_NO" /><parts>	 		/* 売変行№ */
						,</parts><bind id="BIND_JISYA_HBN" /><parts>			/* 自社品番 */
						,</parts><bind id="BIND_IRO_CD" /><parts>				/* 色コード */
						,</parts><bind id="BIND_GENBAIKA_TNK" /><parts> 		/* 現売価 */
						,</parts><bind id="BIND_SYORI_YMD" /><parts>			/* 処理日付 */
						,</parts><bind id="BIND_ADD_YMD" /><parts>				/* 登録日 */
						,</parts><bind id="BIND_ADD_TM" /><parts>				/* 登録時間 */
						,</parts><bind id="BIND_ADD_TANCD" /><parts>			/* 登録担当者コード */
						,</parts><bind id="BIND_UPD_YMD" /><parts>				/* 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>				/* 更新時間 */
						,</parts><bind id="BIND_UPD_TANCD" /><parts>			/* 更新担当者コード */
						,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>			/* 削除日 */
						,0														/* 削除フラグ */
						,1														/* 送信依頼フラグ */
						,0														/* 送信済フラグ */
						,0														/* 送信日 */
						,0														/* 送信時間 */
					)
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 自動売変延長データTBL削除（カラー管理商品）-->
		<sql id="TL030P01-25">
			<statement type="final" name="final">
				<parts>
					DELETE MDCT0050
					WHERE
					    MDCT0050.TENPO_CD        = </parts><bind id="BIND_TENPO_CD" /><parts>
					AND MDCT0050.BAIHENKAISI_YMD = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>
					AND MDCT0050.BAIHENSYURYO_YMD       = </parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts>
					AND MDCT0050.BAIHEN_NO       = </parts><bind id="BIND_BAIHEN_NO" /><parts>
					AND MDCT0050.JISYA_HBN       = </parts><bind id="BIND_JISYA_HBN" /><parts>
					AND MDCT0050.SAKUJYO_FLG     = 0
					AND EXISTS (
								SELECT 1
								  FROM MDCT0010
								 WHERE
									  MDCT0010.TENPO_CD        = MDCT0050.TENPO_CD
								  AND MDCT0010.BAIHENKAISI_YMD = MDCT0050.BAIHENKAISI_YMD
								  AND MDCT0010.BAIHENSYURYO_YMD = MDCT0050.BAIHENSYURYO_YMD
								  AND MDCT0010.BAIHEN_NO       = MDCT0050.BAIHEN_NO
								  AND MDCT0010.JISYA_HBN       = MDCT0050.JISYA_HBN
								  AND (CASE
											WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
											WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
									   END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" /><parts>)</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 自動売変延長データTBL登録（カラー管理商品）-->
		<sql id="TL030P01-26">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0050 (
							 TENPO_CD				/*  1 店舗コード */
							,BAIHENKAISI_YMD		/*  2 売変開始日 */
							,BAIHENSYURYO_YMD		/*  3 売変終了日 */
							,BAIHEN_NO				/*  4 売変№  */
							,BAIHENGYO_NO			/*  5 売変行№ */
							,JISYA_HBN				/*  6 自社品番 */
							,IRO_CD					/*  7 色コード */
							,GENBAIKA_TNK			/*  8 現売価 */
							,ADD_YMD				/* 10 登録日 */
							,ADD_TM					/* 11 登録時間 */
							,ADDTAN_CD				/* 12 登録担当者コード */
							,UPD_YMD				/* 13 更新日 */
							,UPD_TM					/* 14 更新時間 */
							,UPD_TANCD				/* 15 更新担当者コード */
							,SAKUJYO_YMD			/* 16 削除日 */
							,SAKUJYO_FLG			/* 17 削除フラグ */
							,SOSINIRAI_FLG			/* 18 送信依頼フラグ */
							,SOSINZUMI_FLG			/* 19 送信済フラグ */
							,SOSIN_YMD				/* 20 送信日 */
							,SOSIN_TM				/* 21 送信時間 */
							,SYORI_YMD				/* 22 処理日付 */
					) SELECT
							 MDCT0010.TENPO_CD									/*  1 店舗コード */
							,MDCT0010.BAIHENKAISI_YMD							/*  2 売変開始日 */
							,MDCT0010.BAIHENSYURYO_YMD							/*  3 売変終了日 */
							,MDCT0010.BAIHEN_NO									/*  4 売変№  */
							,MDCT0010.BAIHENGYO_NO								/*  5 売変行№ */
							,MDCT0010.JISYA_HBN									/*  6 自社品番 */
							,MDCT0010.IRO_CD									/*  7 色コード */
							,MDCT0010.GENBAIKA_TNK								/*  8 現売価 */
							,MDCT0010.ADD_YMD									/* 10 登録日 */
							,MDCT0010.ADD_TM									/* 11 登録時間 */
							,MDCT0010.ADDTAN_CD									/* 12 登録担当者コード */
							,</parts><bind id="BIND_UPD_YMD" /><parts>			/* 13 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>			/* 14 更新時間 */
							,</parts><bind id="BIND_UPD_TANCD" /><parts>		/* 15 更新担当者コード */
							,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>		/* 16 削除日 */
							,0													/* 17 削除フラグ */
							,1													/* 18 送信依頼フラグ */
							,0													/* 19 送信済フラグ */
							,0													/* 20 送信日 */
							,0													/* 21 送信時間 */
							,</parts><bind id="BIND_SYORI_YMD" /><parts>		/* 22 処理日付 */
					FROM
							MDCT0010
					WHERE
							TENPO_CD			= </parts><bind id="BIND_TENPO_CD" /><parts>			/*  1 店舗コード */
					AND		BAIHENKAISI_YMD		= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/*  2 売変開始日 */
					AND		BAIHENSYURYO_YMD	= </parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts>	/*  3 売変終了日 */
					AND		BAIHEN_NO			= </parts><bind id="BIND_BAIHEN_NO" /><parts>			/*  4 売変№  */
					AND		JISYA_HBN			= </parts><bind id="BIND_JISYA_HBN" /><parts>			/*  6 自社品番 */
					AND		(CASE
								WHEN (MDCT0010.SIJIBAIKA_TNK &lt;&gt; MDCT0010.GENBAIKA_TNK) THEN 0
								WHEN (MDCT0010.SIJIBAIKA_TNK =  MDCT0010.GENBAIKA_TNK) THEN 1
							 END) = </parts><bind id="BIND_BAIKAEQUAL_FLG" />
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 店舗売変確定TBL登録-->
		<sql id="TL030P01-27">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030 (
						 TENPO_CD				/* 店舗コード */
						,BAIHENKAISI_YMD		/* 売変開始日 */
						,BAIHENSYURYO_YMD		/* 売変終了日 */
						,BAIHEN_NO				/* 売変№  */
						,BAIHENGYO_NO			/* 売変行№ */
						,BUMON_CD				/* 部門コード */
						,HINSYU_CD				/* 品種コード */
						,BURANDO_CD 			/* ブランドコード */
						,SYONMK 				/* 商品名(カナ) */
						,MAKER_HBN				/* メーカー品番 */
						,JISYA_HBN				/* 自社品番 */
						,IRO_CD 				/* 色コード */
						,SEASON_KB				/* シーズン */
						,JODAI1_TNK 			/* 上代1 */
						,GENBAIKA_TNK			/* 現売価 */
						,GEN_TNK				/* 原単価 */
						,SIJIBAIKA_TNK			/* 指示売価 */
						,KAKUTEIBAIKA_TNK		/* 確定売価 */
						,ZAIKO_SU				/* 在庫数 */
						,URIAGE_SU				/* 売上数 */
						,HANDLBL_KB 			/* ハンドラベル */
						,SYONIN_FLG				/* 承認状態 */
						,SINSEITAN_CD			/* 申請担当者コード */
						,KAKUTEITAN_CD			/* 確定担当者コード */
						,ADD_YMD				/* 登録日 */
						,ADD_TM 				/* 登録時間 */
						,ADDTAN_CD				/* 登録担当者コード */
						,UPD_YMD				/* 更新日 */
						,UPD_TM 				/* 更新時間 */
						,UPD_TANCD				/* 更新担当者コード */
						,SAKUJYO_YMD			/* 削除日 */
						,SAKUJYO_FLG			/* 削除フラグ */
						,SOSINIRAI_FLG			/* 送信依頼フラグ */
						,SOSINZUMI_FLG			/* 送信済フラグ */
						,SOSIN_YMD				/* 送信日 */
						,SOSIN_TM				/* 送信時間 */
						,HHTSERIAL_NO			/* HHTシリアル番号 */
						,HHTSEQUENCE_NO 		/* HHTシーケンスNo. */
					) VALUES (
						 </parts><bind id="BIND_TENPO_CD" /><parts> 			/* 店舗コード */
						,</parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/* 売変開始日 */
						,</parts><bind id="BIND_BAIHENSYURYO_YMD" /><parts> 	/* 売変終了日 */
						,</parts><bind id="BIND_BAIHEN_NO" /><parts>			/* 売変№  */
						,</parts><bind id="BIND_BAIHENGYO_NO" /><parts> 		/* 売変行№ */
						,</parts><bind id="BIND_BUMON_CD" /><parts> 			/* 部門コード */
						,</parts><bind id="BIND_HINSYU_CD" /><parts>			/* 品種コード */
						,</parts><bind id="BIND_BURANDO_CD" /><parts>			/* ブランドコード */
						,</parts><bind id="BIND_SYONMK" /><parts>				/* 商品名 */
						,</parts><bind id="BIND_MAKER_HBN" /><parts>			/* メーカー品番 */
						,</parts><bind id="BIND_JISYA_HBN" /><parts>			/* 自社品番 */
						,</parts><bind id="BIND_IRO_CD" /><parts>				/* 色コード */
						,</parts><bind id="BIND_SEASON_KB" /><parts>			/* シーズン */
						,</parts><bind id="BIND_JODAI1_TNK" /><parts>			/* 上代1 */
						,</parts><bind id="BIND_GENBAIKA_TNK" /><parts> 		/* 現売価 */
						,</parts><bind id="BIND_GEN_TNK" /><parts>				/* 原単価 */
						,</parts><bind id="BIND_SIJIBAIKA_TNK" /><parts>		/* 指示売価 */
						,</parts><bind id="BIND_KAKUTEIBAIKA_TNK" /><parts> 	/* 確定売価 */
						,</parts><bind id="BIND_ZAIKO_SU" /><parts> 			/* 在庫数 */
						,</parts><bind id="BIND_URIAGE_SU" /><parts>			/* 売上数 */
						,</parts><bind id="BIND_HANDLBL_KB" /><parts>			/* ハンドラベル */
						,</parts><bind id="BIND_SYONIN_FLG" /><parts>			/* 承認状態 */
						,</parts><bind id="BIND_SINSEITAN_CD" /><parts> 		/* 申請担当者コード */
						,</parts><bind id="BIND_KAKUTEITAN_CD" /><parts>		/* 確定担当者コード */
						,</parts><bind id="BIND_ADD_YMD" /><parts>				/* 登録日 */
						,</parts><bind id="BIND_ADD_TM" /><parts>				/* 登録時間 */
						,</parts><bind id="BIND_ADD_TANCD" /><parts>			/* 登録担当者コード */
						,</parts><bind id="BIND_UPD_YMD" /><parts>				/* 更新日 */
						,</parts><bind id="BIND_UPD_TM" /><parts>				/* 更新時間 */
						,</parts><bind id="BIND_UPD_TANCD" /><parts>			/* 更新担当者コード */
						,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>			/* 削除日 */
						,1														/* 削除フラグ */
						,1														/* 送信依頼フラグ */
						,0														/* 送信済フラグ */
						,0														/* 送信日 */
						,0 														/* 送信時間 */
						,</parts><bind id="BIND_HHTSERIAL_NO" /><parts>			/* HHTシリアル番号 */
						,</parts><bind id="BIND_HHTSEQUENCE_NO" /><parts>		/* HHTシーケンスNo. */
					)
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 店舗売変予定TBL更新-->
		<sql id="TL030P01-28">
			<statement type="final" name="final">
				<parts>
					UPDATE MDCT0020 SET	/* 売変予定 */
						 KAKUTEI_FLG      = 1													/* 確定フラグ */
						,UPD_YMD          = </parts><bind id="BIND_UPD_YMD_01" /><parts>		/* 更新日 */
						,UPD_TM           = </parts><bind id="BIND_UPD_TM_01" /><parts>			/* 更新時間 */
						,UPD_TANCD        = </parts><bind id="BIND_UPD_TANCD" /><parts>			/* 更新担当者コード */
						,SAKUJYO_YMD      = </parts><bind id="BIND_SAKUJYO_YMD" /><parts>		/* 削除日 */
						,SAKUJYO_FLG      = 1
					WHERE EXISTS (
						SELECT 1
						FROM
							MDCT0030	/* 売変確定 */
						WHERE
							MDCT0030.TENPO_CD        = MDCT0020.TENPO_CD
						AND	MDCT0030.BAIHENKAISI_YMD = MDCT0020.BAIHENKAISI_YMD
						AND	MDCT0030.BAIHEN_NO       = MDCT0020.BAIHEN_NO
						AND	MDCT0030.BAIHENGYO_NO    = MDCT0020.BAIHENGYO_NO
						AND	MDCT0030.UPD_YMD         = </parts><bind id="BIND_UPD_YMD_02" /><parts>	/* 更新日 */
						AND	MDCT0030.UPD_TM          = </parts><bind id="BIND_UPD_TM_02" /><parts>	/* 更新時間 */
					)
					AND	TENPO_CD          = </parts><bind id="BIND_TENPO_CD" /><parts>			/* 店舗コード */
					AND	BAIHENKAISI_YMD   = </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>	/* 売変開始日 */
					AND	BAIHEN_NO         = </parts><bind id="BIND_BAIHEN_NO" /><parts>			/* 売変No */
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 店舗売変確定TBL登録（カラー管理商品)-->
		<sql id="TL030P01-29">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030 (
							 TENPO_CD				/* 店舗コード */
							,BAIHENKAISI_YMD		/* 売変開始日 */
							,BAIHENSYURYO_YMD		/* 売変終了日 */
							,BAIHEN_NO				/* 売変№  */
							,BAIHENGYO_NO			/* 売変行№ */
							,BUMON_CD				/* 部門コード */
							,HINSYU_CD				/* 品種コード */
							,BURANDO_CD				/* ブランドコード */
							,SYONMK					/* 商品名(カナ) */
							,MAKER_HBN				/* メーカー品番 */
							,JISYA_HBN				/* 自社品番 */
							,IRO_CD					/* 色コード */
							,SEASON_KB				/* シーズン */
							,JODAI1_TNK				/* 上代1 */
							,GENBAIKA_TNK			/* 現売価 */
							,GEN_TNK				/* 原単価 */
							,SIJIBAIKA_TNK			/* 指示売価 */
							,KAKUTEIBAIKA_TNK		/* 確定売価 */
							,ZAIKO_SU				/* 在庫数 */
							,URIAGE_SU				/* 売上数 */
							,HANDLBL_KB				/* ハンドラベル */
							,SYONIN_FLG				/* 承認状態 */
							,SINSEITAN_CD			/* 申請担当者コード */
							,KAKUTEITAN_CD			/* 確定担当者コード */
							,ADD_YMD				/* 登録日 */
							,ADD_TM					/* 登録時間 */
							,ADDTAN_CD				/* 登録担当者コード */
							,UPD_YMD				/* 更新日 */
							,UPD_TM					/* 更新時間 */
							,UPD_TANCD				/* 更新担当者コード */
							,SAKUJYO_YMD			/* 削除日 */
							,SAKUJYO_FLG			/* 削除フラグ */
							,SOSINIRAI_FLG			/* 送信依頼フラグ */
							,SOSINZUMI_FLG			/* 送信済フラグ */
							,SOSIN_YMD				/* 送信日 */
							,SOSIN_TM				/* 送信時間 */
							,HHTSERIAL_NO			/* HHTシリアル番号 */
							,HHTSEQUENCE_NO			/* HHTシーケンスNo. */
					) SELECT
							 MDCT0020.TENPO_CD											/* 店舗コード */
							,MDCT0020.BAIHENKAISI_YMD									/* 売変開始日 */
							,MDCT0020.BAIHENSYURYO_YMD									/* 売変終了日 */
							,MDCT0020.BAIHEN_NO											/* 売変№  */
							,MDCT0020.BAIHENGYO_NO										/* 売変行№ */
							,MDCT0020.BUMON_CD											/* 部門コード */
							,MDCT0020.HINSYU_CD											/* 品種コード */
							,MDCT0020.BURANDO_CD										/* ブランドコード */
							,MDCT0020.SYONMK											/* 商品名 */
							,MDCT0020.MAKER_HBN											/* メーカー品番 */
							,MDCT0020.JISYA_HBN											/* 自社品番 */
							,MDCT0020.IRO_CD											/* 色コード */
							,MDCT0020.SEASON_KB											/* シーズン */
							,MDCT0020.JODAI1_TNK										/* 上代1 */
							,MDCT0020.GENBAIKA_TNK										/* 現売価 */
							,MDCT0020.GEN_TNK											/* 原単価 */
							,</parts><bind id="BIND_SIJIBAIKA_TNK" /><parts>			/* 指示売価 */
							,</parts><bind id="BIND_KAKUTEIBAIKA_TNK" /><parts>			/* 確定売価 */
							,( NVL((SELECT SUM(MDBT0030.FREEZAIKO_SU) FROM MDBT0030 WHERE MDBT0030.TENPO_CD = </parts><bind id="BIND_TENPO_CD_01" /><parts> AND MDBT0030.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0030.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0030.IRO_CD = MDCT0020.IRO_CD), 0)
							 + NVL((SELECT SUM(MDBT0040.FREEZAIKO_SU) FROM MDBT0040 WHERE MDBT0040.TENPO_CD = </parts><bind id="BIND_TENPO_CD_02" /><parts> AND MDBT0040.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0040.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0040.IRO_CD = MDCT0020.IRO_CD), 0)
							 + NVL((SELECT SUM(MDBT0060.FREEZAIKO_SU) FROM MDBT0060 WHERE MDBT0060.TENPO_CD = </parts><bind id="BIND_TENPO_CD_03" /><parts> AND MDBT0060.TENPO_CD = MDCT0020.TENPO_CD AND MDBT0060.JISYA_HBN = MDCT0020.JISYA_HBN AND MDBT0060.IRO_CD = MDCT0020.IRO_CD), 0))	/* 在庫数 */
							,MDCT0020.URIAGE_SU											/* 売上数 */
							,MDCT0020.HANDLBL_KB										/* ハンドラベル */
							,</parts><bind id="BIND_SYONIN_FLG" /><parts>				/* 承認状態 */
							,</parts><bind id="BIND_SINSEITAN_CD" /><parts> 			/* 申請担当者コード */
							,</parts><bind id="BIND_KAKUTEITAN_CD" /><parts>			/* 確定担当者コード */
							,</parts><bind id="BIND_ADD_YMD" /><parts>					/* 登録日 */
							,</parts><bind id="BIND_ADD_TM" /><parts>					/* 登録時間 */
							,</parts><bind id="BIND_ADD_TANCD" /><parts>				/* 登録担当者コード */
							,</parts><bind id="BIND_UPD_YMD" /><parts>					/* 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>					/* 更新時間 */
							,</parts><bind id="BIND_UPD_TANCD" /><parts>				/* 更新担当者コード */
							,</parts><bind id="BIND_SAKUJYO_YMD" /><parts>				/* 削除日 */
							,1															/* 削除フラグ */
							,1															/* 送信依頼フラグ */
							,0															/* 送信済フラグ */
							,0															/* 送信日 */
							,0 															/* 送信時間 */
							,</parts><bind id="BIND_HHTSERIAL_NO" /><parts>				/* HHTシリアル番号 */
							,</parts><bind id="BIND_HHTSEQUENCE_NO" /><parts>			/* HHTシーケンスNo. */
					FROM
							MDCT0020					/* 店舗売変予定TBL */
					WHERE
							TENPO_CD		= </parts><bind id="BIND_TENPO_CD_04" /><parts>			/* 店舗コード */
					AND		BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>		/* 売変開始日 */
					AND		BAIHEN_NO		= </parts><bind id="BIND_BAIHEN_NO" /><parts>			/* 売変№  */
					AND		JISYA_HBN		= </parts><bind id="BIND_JISYA_HBN" /><parts>			/* 自社品番 */
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 売変確定一時TBL登録（カラー管理商品)-->
		<sql id="TL030P01-30">
			<statement type="final" name="final">
				<parts>
					INSERT INTO MDCT0030_TEMP (
							 BAIHEN_NO															/* 売変NO */
							,TENPO_CD															/* 店舗コード */
							,JISYA_HBN															/* 自社品番 */
							,IRO_CD																/* 色コード */
							,KAKUTEIBAIKA_TNK													/* 確定売価 */
							,UPD_YMD															/* 更新日 */
							,UPD_TM																/* 更新時間 */
					) SELECT
							 MDCT0020.BAIHEN_NO													/* 売変NO */
							,MDCT0020.TENPO_CD													/* 店舗コード */
							,MDCT0020.JISYA_HBN													/* 自社品番 */
							,MDCT0020.IRO_CD													/* 色コード */
							,</parts><bind id="BIND_KAKUTEIBAIKA_TNK" /><parts>					/* 確定売価 */
							,</parts><bind id="BIND_UPD_YMD" /><parts>							/* 更新日 */
							,</parts><bind id="BIND_UPD_TM" /><parts>							/* 更新時間 */
					FROM
							MDCT0020					/* 店舗売変予定TBL */
					WHERE
							TENPO_CD		= </parts><bind id="BIND_TENPO_CD" /><parts>		/* 店舗コード */
					AND		BAIHENKAISI_YMD	= </parts><bind id="BIND_BAIHENKAISI_YMD" /><parts>	/* 売変開始日 */
					AND		BAIHEN_NO		= </parts><bind id="BIND_BAIHEN_NO" /><parts>		/* 売変№  */
					AND		JISYA_HBN		= </parts><bind id="BIND_JISYA_HBN" /><parts>		/* 自社品番 */
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 売変確定ワーク登録-->
		<sql id="TL030P01-31">
			<statement type="final" name="final">
				<parts>
					INSERT INTO W_MDCT0030 (
							 SEQ
							,UPD_YMD
							,UPD_TM
							,UPD_TANCD
					)
					VALUES
					(
							</parts><bind id="BIND_SEQ" /><parts>
							,</parts><bind id="BIND_UPD_YMD" /><parts>
							,</parts><bind id="BIND_UPD_TM" /><parts>
							,</parts><bind id="BIND_TANCD" /><parts>
					)
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 印刷用CSV出力-->
		<sql id="TL030P01-32">
			<statement type="final" name="final">
				<parts>
					-- 印刷処理用SQL　売変確定
					SELECT
						 2 SINSEIMOTO                 /*  1 申請元(本部:1,店舗:2) */
						,DECODE(SIGN(MDCT0030.KAKUTEIBAIKA_TNK - MDCT0030.GENBAIKA_TNK),1,1,2) HANTEI /*  2 値上げ判定 */
						,MDCT0030.TENPO_CD TENPO_CD   /*  3 店舗コード */
						,BOMT0010.TENPO_NM            /*  4 店舗名 */
						,MDCT0030.BUMON_CD BUMON_CD   /*  5 部門コード */
						,BOMT0060.BUMON_NM            /*  6 部門名 */
						,BOMT0030.HANBAIIN_NM         /*  7 登録確定者 */
						,'' SINSEICOMMENT_NM          /*  8 コメント */
						,MDMT0070.HINSYU_RYAKU_NM     /*  9 品種名 */
						,MDCT0030.BAIHENKAISI_YMD     /* 10 開始日 */
						,STMT0500.BURANDO_NMK         /* 11 ブランド */
						,MDCT0030.MAKER_HBN MAKER_HBN /* 12 メーカー品番 */
						,MDCT0030.SYONMK              /* 13 商品名(カナ) */
						,MDCT0030.JISYA_HBN JISYA_HBN /* 14 自社品番 */
						,MDMT0080.IRO_NM              /* 15 色名 */
						,MDCT0030.JODAI1_TNK          /* 16 現売価 */
						,MIN(MDCT0030.GENBAIKA_TNK) GENBAIKA_TNK  /* 17 旧売価 */
						,MDCT0030.KAKUTEIBAIKA_TNK    /* 18 新売価 */
						,MDMT0130.ZEI_KB              /* 19 税区分 */
						,MDCT0030.ZAIKO_SU            /* 20 在庫数 */
						,MDMT0100.MEISYO_NM           /* 21 ラベル */
						,(MDCT0030.TENPO_CD || MDCT0030.BUMON_CD || DECODE(SIGN(MDCT0030.KAKUTEIBAIKA_TNK - MDCT0030.GENBAIKA_TNK),1,1,2) || '                                                                                                    ' || 2 || MDCT0030.ADDTAN_CD)
						BREAK                         /* 22 ブレークキー （店舗-部門-値上げ判定-申請元-登録担当者コード） */
						,0  BAIHENSAGYOKAISI_YMD      /* 23 作業開始日 */
						,MAX(MDMT0130.HANBAIKANRYO_YMD) HANBAIKANRYO_YMD      /* 24 販売完了日 */
						,MDCT0030.HANDLBL_KB HANDLBL_KB       /* 24 ハンドラベル（出力順用） */
						,MDCT0030.BURANDO_CD BURANDO_CD       /* 25 ブランドコード（出力順用） */
						,MDCT0030.IRO_CD IRO_CD               /* 26 色コード（出力順用） */
						,MDCT0030.ADDTAN_CD ADDTAN_CD         /* 27 登録担当者コード（出力順用） */
						,MAX((SELECT MAX(TAX_CD) FROM MDMT0270 WHERE MDMT0270.TAX = 
								(SELECT MAX(TAX) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0030.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0030.IRO_CD))) TAX_CD						/* 28 税率コード */
					FROM
						 MDCT0030                     /* 売価変更確定TBL */
						,BOMT0010                     /* 店舗MST */
						,BOMT0030                     /* 販売員MST */
						,BOMT0060                     /* 部門MST */
						,MDMT0070                     /* 品種MST */
						,MDMT0080                     /* 色MST */
						,MDMT0100                     /* 名称MST */
						,STMT0500                     /* ブランドマスタ */
						,MDMT0130         /* 発注マスタ */
						,STMT0091         /* 店別単価 */
					WHERE   MDCT0030.TENPO_CD    = BOMT0010.TENPO_CD(+)
						AND MDCT0030.BUMON_CD        = MDMT0070.BUMON_CD(+)
						AND MDCT0030.HINSYU_CD       = MDMT0070.HINSYU_CD(+)
						AND MDCT0030.BUMON_CD        = BOMT0060.BUMON_CD(+)
						AND MDCT0030.HANDLBL_KB      = MDMT0100.MEISYO_CD(+)
						AND MDCT0030.ADDTAN_CD       = BOMT0030.HANBAIIN_CD(+)
						AND MDCT0030.BURANDO_CD      = STMT0500.BURANDO_CD(+)
						AND MDCT0030.IRO_CD          = MDMT0080.IRO_CD(+)
						AND MDCT0030.JISYA_HBN       = MDMT0130.XEBIO_CD(+)
						AND MDCT0030.IRO_CD          = MDMT0130.MAKERCOLOR_CD(+)
						AND MDMT0100.SIKIBETSU_CD(+) = 'HDLB'
						AND MDCT0030.TENPO_CD        = </parts><bind id="BIND_TENPO_CD_01" /><parts>
						AND STMT0091.SOSIKI        = '0001'
						AND STMT0091.TENCD         = </parts><bind id="BIND_TENPO_CD_02" /><parts>
						AND STMT0091.SKU           = MDMT0130.JAN_CD
						AND MDCT0030.ZAIKO_SU      > 0
						AND MDCT0030.SYONIN_FLG      = 1
					-- 売変確定ワークを条件とする
					AND EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_01" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0030.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0030.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0030.UPD_TANCD
					)
					-- 同一自社品番が存在する場合、売変Noの大きい方を出力する
					AND (
						 MDCT0030.TENPO_CD
						,MDCT0030.BAIHENKAISI_YMD
						,MDCT0030.BAIHEN_NO
						,MDCT0030.JISYA_HBN
						,MDCT0030.IRO_CD
					) IN (
						SELECT
							 MDCT0030_MAX.TENPO_CD
							,TO_NUMBER(SUBSTR(MAX(MDCT0030_MAX.BAIHEN_NO || MDCT0030_MAX.BAIHENKAISI_YMD), 11, 8))
							,SUBSTR(MAX(MDCT0030_MAX.BAIHEN_NO || MDCT0030_MAX.BAIHENKAISI_YMD), 1, 10)
							,MDCT0030_MAX.JISYA_HBN
							,MDCT0030_MAX.IRO_CD
						FROM
							MDCT0030 MDCT0030_MAX
						WHERE
							MDCT0030_MAX.TENPO_CD        = </parts><bind id="BIND_TENPO_CD_03" /><parts>
							-- 売変確定ワークを条件とする
							AND EXISTS( 	
								SELECT 1
								FROM W_MDCT0030
								WHERE 
								W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_02" /><parts>
								AND W_MDCT0030.UPD_YMD = MDCT0030_MAX.UPD_YMD
								AND W_MDCT0030.UPD_TM = MDCT0030_MAX.UPD_TM
								AND W_MDCT0030.UPD_TANCD = MDCT0030_MAX.UPD_TANCD
							)
							GROUP BY
								 MDCT0030_MAX.TENPO_CD
								,MDCT0030_MAX.JISYA_HBN
								,MDCT0030_MAX.IRO_CD
					)
					GROUP BY
						 MDCT0030.TENPO_CD            /*  3 店舗コード */
						,BOMT0010.TENPO_NM            /*  4 店舗名 */
						,MDCT0030.BUMON_CD            /*  5 部門コード */
						,BOMT0060.BUMON_NM            /*  6 部門名 */
						,BOMT0030.HANBAIIN_NM         /*  7 登録確定者 */
						,MDMT0070.HINSYU_RYAKU_NM     /*  9 品種名 */
						,MDCT0030.BAIHENKAISI_YMD     /* 10 開始日 */
						,STMT0500.BURANDO_NMK         /* 11 ブランド */
						,MDCT0030.MAKER_HBN           /* 12 メーカー品番 */
						,MDCT0030.SYONMK              /* 13 商品名(カナ) */
						,MDCT0030.JISYA_HBN           /* 14 自社品番 */
						,MDMT0080.IRO_NM              /* 15 色名 */
						,MDCT0030.JODAI1_TNK          /* 16 現売価 */
						,MDCT0030.GENBAIKA_TNK        /* 17 旧売価 */
						,MDCT0030.KAKUTEIBAIKA_TNK    /* 18 新売価 */
						,MDMT0130.ZEI_KB              /* 19 税区分 */
						,MDCT0030.ZAIKO_SU            /* 20 在庫数 */
						,MDMT0100.MEISYO_NM           /* 21 ラベル */
						,MDCT0030.HANDLBL_KB          /* 23 ハンドラベル（出力順用） */
						,MDCT0030.TENPO_CD || MDCT0030.BUMON_CD || DECODE(SIGN(MDCT0030.KAKUTEIBAIKA_TNK - MDCT0030.GENBAIKA_TNK),1,1,2) || '                                                                                                    ' || 2 || MDCT0030.ADDTAN_CD /* 22 ブレークキー （店舗-部門-値上げ判定-申請元-登録担当者コード） */
						,MDCT0030.BURANDO_CD          /* 24 ブランドコード（出力順用） */
						,MDCT0030.IRO_CD              /* 25 色コード（出力順用） */
						,MDCT0030.ADDTAN_CD           /* 26 登録担当者コード（出力順用） */
						,DECODE(SIGN(MDCT0030.KAKUTEIBAIKA_TNK - MDCT0030.GENBAIKA_TNK),1,1,2)    /*  2 値上げ判定 */
					UNION ALL
					SELECT
						 1 SINSEIMOTO                 /*  1 申請元(本部:1,店舗:2) */
						,DECODE(SIGN(MDCT0010.SIJIBAIKA_TNK - MDCT0010.GENBAIKA_TNK),1,1,2) HANTEI    /*  2 値上げ判定 */
						,MDCT0010.TENPO_CD TENPO_CD   /*  3 店舗コード */
						,BOMT0010.TENPO_NM            /*  4 店舗名 */
						,MDCT0010.BUMON_CD BUMON_CD   /*  5 部門コード */
						,BOMT0060.BUMON_NM            /*  6 部門名 */
						,'' HANBAIIN_NM                          /*  7 登録確定者 */
						,NVL(MDCT0010.SINSEICOMMENT_NM,'') SINSEICOMMENT_NM /*  8 コメント */
						,MDMT0070.HINSYU_RYAKU_NM     /*  9 品種名 */
						,MDCT0010.BAIHENKAISI_YMD     /* 10 開始日 */
						,STMT0500.BURANDO_NMK         /* 11 ブランド */
						,MDCT0010.MAKER_HBN MAKER_HBN /* 12 メーカー品番 */
						,MDCT0010.SYONMK              /* 13 商品名(カナ) */
						,MDCT0010.JISYA_HBN JISYA_HBN /* 14 自社品番 */
						,MDMT0080.IRO_NM              /* 15 色名 */
						,MDCT0010.JODAI1_TNK          /* 16 現売価 */
						,    MIN(CASE
						            WHEN KAKUTEI_FLG = 1 THEN MDCT0010.GENBAIKA_TNK
						            ELSE (CASE WHEN STMT0091.SLPR IS NULL THEN MDMT0130.SLPR ELSE STMT0091.SLPR END)
						     END)  GENBAIKA_TNK                         /* 17  旧売価 */
						,MDCT0010.SIJIBAIKA_TNK       /* 18 新売価 */
						,MDMT0130.ZEI_KB              /* 19 税区分 */
						,MDCT0010.ZAIKO_SU            /* 20 在庫数 */
						,MDMT0100.MEISYO_NM           /* 21 ラベル */
						,(MDCT0010.TENPO_CD || MDCT0010.BUMON_CD || DECODE(SIGN(MDCT0010.SIJIBAIKA_TNK - MDCT0010.GENBAIKA_TNK),1,1,2) || NVL(MDCT0010.SINSEICOMMENT_NM,'                                                                                                    ') || 1 || '       ') /* 22 ブレークキー （店舗-部門-値上げ判定-申請元-登録担当者コード） */
						BREAK
						,MDCT0010.BAIHENSAGYOKAISI_YMD        /* 23 作業開始日 */
						,MAX(MDMT0130.HANBAIKANRYO_YMD) HANBAIKANRYO_YMD      /* 28 販売完了日 */
						,MDCT0010.HANDLBL_KB HANDLBL_KB       /* 24 ハンドラベル（出力順用） */
						,MDCT0010.BURANDO_CD BURANDO_CD       /* 25 ブランドコード（出力順用） */
						,MDCT0010.IRO_CD IRO_CD               /* 26 色コード（出力順用） */
						,'' ADDTAN_CD                         /* 27 登録担当者コード（出力順用） */
						,MAX((SELECT MAX(TAX_CD) FROM MDMT0270 WHERE MDMT0270.TAX = 
								(SELECT MAX(TAX) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0010.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0010.IRO_CD))) TAX_CD	/* 税率コード) */
					FROM
						 MDCT0010                     /* 売価変更確定TBL */
						,BOMT0010                     /* 店舗MST */
						,BOMT0030                     /* 販売員MST */
						,BOMT0060                     /* 部門MST */
						,MDMT0070                     /* 品種MST */
						,MDMT0080                     /* 色MST */
						,MDMT0100                     /* 名称MST */
						,STMT0500                     /* ブランドマスタ */
						,MDMT0130                     /* 発注マスタ */
						,STMT0091                     /* 店別単価 */
					WHERE MDCT0010.TENPO_CD        = BOMT0010.TENPO_CD(+)
						AND   MDCT0010.BUMON_CD        = MDMT0070.BUMON_CD(+)
						AND   MDCT0010.HINSYU_CD       = MDMT0070.HINSYU_CD(+)
						AND   MDCT0010.BUMON_CD        = BOMT0060.BUMON_CD(+)
						AND   MDCT0010.HANDLBL_KB      = MDMT0100.MEISYO_CD(+)
						AND   MDCT0010.ADDTAN_CD       = BOMT0030.HANBAIIN_CD(+)
						AND   MDCT0010.BURANDO_CD      = STMT0500.BURANDO_CD(+)
						AND   MDCT0010.IRO_CD          = MDMT0080.IRO_CD(+)
						AND   MDCT0010.JISYA_HBN       = MDMT0130.XEBIO_CD(+)
						AND   MDCT0010.IRO_CD          = MDMT0130.MAKERCOLOR_CD(+)
						AND   MDMT0100.SIKIBETSU_CD(+) = 'HDLB'
						AND   MDCT0010.TENPO_CD        = </parts><bind id="BIND_TENPO_CD_04" /><parts>
						AND   STMT0091.SOSIKI        = '0001'
						AND   STMT0091.TENCD         = </parts><bind id="BIND_TENPO_CD_05" /><parts>
						AND   STMT0091.SKU           = MDMT0130.JAN_CD
						AND   ((  MDCT0010.ZAIKO_SU      > 0 AND MDCT0010.ADD_KBN = '1') OR (MDCT0010.ADD_KBN = '2'))
						AND   MDCT0010.KAKUTEI_FLG = 1
					-- 売変確定ワークを条件とする
					AND EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						SEQ = </parts><bind id="BIND_SEQ_03" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0010.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0010.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0010.UPD_TANCD
						)
					AND (
						 MDCT0010.TENPO_CD
						,MDCT0010.BAIHENKAISI_YMD
						,MDCT0010.BAIHEN_NO
						,MDCT0010.JISYA_HBN
						,MDCT0010.IRO_CD
					) IN (
						SELECT
							 MDCT0010_MAX.TENPO_CD
							,TO_NUMBER(SUBSTR(MAX(MDCT0010_MAX.BAIHEN_NO || MDCT0010_MAX.BAIHENKAISI_YMD), 11, 8))
							,SUBSTR(MAX(MDCT0010_MAX.BAIHEN_NO || MDCT0010_MAX.BAIHENKAISI_YMD), 1, 10)
							,MDCT0010_MAX.JISYA_HBN
							,MDCT0010_MAX.IRO_CD
						FROM
							MDCT0010 MDCT0010_MAX
						WHERE
						MDCT0010_MAX.TENPO_CD        = </parts><bind id="BIND_TENPO_CD_06" /><parts>
							-- 売変確定ワークを条件とする
							AND EXISTS( 	
								SELECT 1
								FROM W_MDCT0030
								WHERE 
								W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_04" /><parts>
								AND W_MDCT0030.UPD_YMD = MDCT0010_MAX.UPD_YMD
								AND W_MDCT0030.UPD_TM = MDCT0010_MAX.UPD_TM
								AND W_MDCT0030.UPD_TANCD = MDCT0010_MAX.UPD_TANCD
							)
							GROUP BY
								 MDCT0010_MAX.TENPO_CD
								,MDCT0010_MAX.JISYA_HBN
								,MDCT0010_MAX.IRO_CD
					)
					GROUP BY
						 MDCT0010.TENPO_CD            /*  3 店舗コード */
						,BOMT0010.TENPO_NM            /*  4 店舗名 */
						,MDCT0010.BUMON_CD            /*  5 部門コード */
						,BOMT0060.BUMON_NM            /*  6 部門名 */
						,MDCT0010.SINSEICOMMENT_NM    /*  8 コメント */
						,MDMT0070.HINSYU_RYAKU_NM     /*  9 品種名 */
						,MDCT0010.BAIHENKAISI_YMD     /* 10 開始日 */
						,STMT0500.BURANDO_NMK         /* 11 ブランド */
						,MDCT0010.MAKER_HBN           /* 12 メーカー品番 */
						,MDCT0010.SYONMK              /* 13 商品名(カナ) */
						,MDCT0010.JISYA_HBN           /* 14 自社品番 */
						,MDMT0080.IRO_NM              /* 15 色名 */
						,MDCT0010.JODAI1_TNK          /* 16 現売価 */
						,MDCT0010.GENBAIKA_TNK        /* 17 旧売価 */
						,MDCT0010.SIJIBAIKA_TNK       /* 18 新売価 */
						,MDMT0130.ZEI_KB              /* 19 税区分 */
						,MDCT0010.ZAIKO_SU            /* 20 在庫数 */
						,MDMT0100.MEISYO_NM           /* 21 ラベル */
						,MDCT0010.TENPO_CD || MDCT0010.BUMON_CD || DECODE(SIGN(MDCT0010.SIJIBAIKA_TNK - MDCT0010.GENBAIKA_TNK),1,1,2) || NVL(MDCT0010.SINSEICOMMENT_NM,'                                                                                                    ') || 1 || '       ' /* 22 ブレークキー （店舗-部門-値上げ判定-申請元-登録担当者コード） */
						,MDCT0010.BAIHENSAGYOKAISI_YMD    /* 23 売変作業開始日 */
						,MDCT0010.HANDLBL_KB      /* 24 ハンドラベル（出力順用） */
						,MDCT0010.BURANDO_CD      /* 25 ブランドコード（出力順用） */
						,MDCT0010.IRO_CD          /* 26 色コード（出力順用） */
						,DECODE(SIGN(MDCT0010.SIJIBAIKA_TNK - MDCT0010.GENBAIKA_TNK),1,1,2) 
					ORDER BY
						 TENPO_CD
						,BUMON_CD
						,HANTEI
						,SINSEICOMMENT_NM
						,SINSEIMOTO
						,ADDTAN_CD
						,HANDLBL_KB
						,BURANDO_CD
						,MAKER_HBN
						,JISYA_HBN
						,IRO_CD
				</parts>
			</statement>
		</sql>

		<!--売変確定(X) 一覧 確定 売変シール発行用CSV出力-->
		<sql id="TL030P01-33">
			<statement type="final" name="final">
				<parts>
					SELECT
							 MAX(MDCT0030.BUMON_CD) BUMON_CD					/* 部門コード */
							,MAX(BOMT0060.BUMON_NM) BUMON_NM					/* 部門名 */
							,MAX(MDCT0030.HANDLBL_KB) HANDLBL_KB				/* ラベル */
							,MAX(MDMT0100.MEISYO_NM) MEISYO_NM					/* ラベル名 */
							,MAX((SELECT MAX(ZEI_KB) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0030.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0030.IRO_CD)) ZEI_KB /* 税区分 */
							,MAX(MDCT0030.KAKUTEIBAIKA_TNK) KAKUTEIBAIKA_TNK	/* 税抜価格 */
							,MAX(MDCT0030.KAKUTEIBAIKA_TNK) KAKUTEIBAIKA_TNK2	/* 税込価格 */
							,NVL(SUM(ZAIKO1.FREEZAIKO_SU),0) FREEZAIKO_SU		/* 在庫数 */
							,MAX(MDCT0030.BURANDO_CD) BURANDO_CD				/* ブランドコード */
							,MAX(MDCT0030.JISYA_HBN) JISYA_HBN					/* 自社品番 */
							,MAX(MDCT0030.IRO_CD) IRO_CD						/* 色 */
							,MAX((SELECT MAX(TAX_CD) FROM MDMT0270 WHERE MDMT0270.TAX = 
								(SELECT MAX(TAX) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0030.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0030.IRO_CD))) TAX_CD
					FROM
							 MDCT0030		  /* 売変確定 */
							,BOMT0060		  /* 部門マスタ */
							,MDMT0100		  /* 名称マスタ */
							,(
								SELECT
									 MDBT0030.TENPO_CD
									,MDBT0030.JISYA_HBN
									,MDBT0030.IRO_CD
									,MDBT0030.FREEZAIKO_SU
								FROM
									MDBT0030  /* 前日在庫 */
								UNION ALL
								SELECT
									 MDBT0040.TENPO_CD
									,MDBT0040.JISYA_HBN
									,MDBT0040.IRO_CD
									,MDBT0040.FREEZAIKO_SU
								FROM
									MDBT0040  /* 当日受払 */
								UNION ALL
								SELECT
									 MDBT0060.TENPO_CD
									,MDBT0060.JISYA_HBN
									,MDBT0060.IRO_CD
									,MDBT0060.FREEZAIKO_SU
								FROM
									MDBT0060  /* 受払履歴集計 */
							) ZAIKO1		  /* リアル在庫 */
					WHERE
							MDCT0030.BUMON_CD	 = BOMT0060.BUMON_CD
					AND MDMT0100.SIKIBETSU_CD(+) = 'HDSL'
					AND MDCT0030.HANDLBL_KB 	 = MDMT0100.MEISYO_CD(+)
					AND MDCT0030.TENPO_CD		 = ZAIKO1.TENPO_CD(+)
					AND MDCT0030.JISYA_HBN		 = ZAIKO1.JISYA_HBN(+)
					AND MDCT0030.IRO_CD 		 = ZAIKO1.IRO_CD(+)
					AND MDCT0030.SYONIN_FLG 	 = 1  /* 確定済みのデータのみ */
					AND MDCT0030.KAKUTEIBAIKA_TNK &lt;= 999999
					AND EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_01" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0030.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0030.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0030.UPD_TANCD
					)	
					AND (
						 MDCT0030.TENPO_CD
						,MDCT0030.BAIHENKAISI_YMD
						,MDCT0030.BAIHEN_NO
						,MDCT0030.JISYA_HBN
						,MDCT0030.IRO_CD
					) IN (
						SELECT
							 MDCT0030_MAX.TENPO_CD
							,TO_NUMBER(SUBSTR(MAX(MDCT0030_MAX.BAIHEN_NO || MDCT0030_MAX.BAIHENKAISI_YMD), 11, 8))
							,SUBSTR(MAX(MDCT0030_MAX.BAIHEN_NO || MDCT0030_MAX.BAIHENKAISI_YMD), 1, 10)
							,MDCT0030_MAX.JISYA_HBN
							,MDCT0030_MAX.IRO_CD
						FROM
							MDCT0030 MDCT0030_MAX
						WHERE
					EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_02" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0030_MAX.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0030_MAX.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0030_MAX.UPD_TANCD
					)	
						GROUP BY
							 MDCT0030_MAX.TENPO_CD
							,MDCT0030_MAX.JISYA_HBN
							,MDCT0030_MAX.IRO_CD
					)
					GROUP BY
							 MDCT0030.JISYA_HBN
							,MDCT0030.IRO_CD
					HAVING
							NVL(SUM(ZAIKO1.FREEZAIKO_SU),0) &gt; 0
					 UNION ALL 
					SELECT
							 MAX(MDCT0010.BUMON_CD) BUMON_CD				/* 部門コード */
							,MAX(BOMT0060.BUMON_NM) BUMON_NM				/* 部門名 */
							,MAX(MDCT0010.HANDLBL_KB) HANDLBL_KB			/* ラベル */
							,MAX(MDMT0100.MEISYO_NM) MEISYO_NM				/* ラベル名 */
							,MAX((SELECT MAX(ZEI_KB) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0010.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0010.IRO_CD)) ZEI_KB /* 税区分 */
							,MAX(MDCT0010.SIJIBAIKA_TNK) KAKUTEIBAIKA_TNK	/* 税抜価格 */
							,MAX(MDCT0010.SIJIBAIKA_TNK) KAKUTEIBAIKA_TNK2	/* 税込価格 */
							,NVL(SUM(ZAIKO2.FREEZAIKO_SU),0) FREEZAIKO_SU	/* 在庫数 */
							,MAX(MDCT0010.BURANDO_CD) BURANDO_CD			/* ブランドコード */
							,MAX(MDCT0010.JISYA_HBN) JISYA_HBN				/* 自社品番 */
							,MAX(MDCT0010.IRO_CD) IRO_CD					/* 色 */
							,MAX((SELECT MAX(TAX_CD) FROM MDMT0270 WHERE MDMT0270.TAX = 
								(SELECT MAX(TAX) FROM MDMT0130 WHERE MDMT0130.XEBIO_CD = MDCT0010.JISYA_HBN AND MDMT0130.MAKERCOLOR_CD = MDCT0010.IRO_CD))) TAX_CD
					FROM
							 MDCT0010		  /* 売変指示 */
							,BOMT0060		  /* 部門マスタ */
							,MDMT0100		  /* 名称マスタ */
							,(
								SELECT
									 MDBT0030.TENPO_CD
									,MDBT0030.JISYA_HBN
									,MDBT0030.IRO_CD
									,MDBT0030.FREEZAIKO_SU
								FROM
									MDBT0030  /* 前日在庫 */
								UNION ALL
								SELECT
									 MDBT0040.TENPO_CD
									,MDBT0040.JISYA_HBN
									,MDBT0040.IRO_CD
									,MDBT0040.FREEZAIKO_SU
								FROM
									MDBT0040  /* 当日受払 */
								UNION ALL
								SELECT
									 MDBT0060.TENPO_CD
									,MDBT0060.JISYA_HBN
									,MDBT0060.IRO_CD
									,MDBT0060.FREEZAIKO_SU
								FROM
									MDBT0060  /* 受払履歴集計 */
							) ZAIKO2		  /* リアル在庫 */
					WHERE
						MDCT0010.BUMON_CD		 = BOMT0060.BUMON_CD
					AND MDMT0100.SIKIBETSU_CD(+) = 'HDSL'
					AND MDCT0010.HANDLBL_KB 	 = MDMT0100.MEISYO_CD(+)
					AND MDCT0010.TENPO_CD		 = ZAIKO2.TENPO_CD(+)
					AND MDCT0010.JISYA_HBN		 = ZAIKO2.JISYA_HBN(+)
					AND MDCT0010.IRO_CD 		 = ZAIKO2.IRO_CD(+)
					AND MDCT0010.SIJIBAIKA_TNK &lt;= 999999
					AND MDCT0010.KAKUTEI_FLG = 1

					AND EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_03" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0010.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0010.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0010.UPD_TANCD
					)	
					AND (
						 MDCT0010.TENPO_CD
						,MDCT0010.BAIHENKAISI_YMD
						,MDCT0010.BAIHEN_NO
						,MDCT0010.JISYA_HBN
						,MDCT0010.IRO_CD
					) IN (
						SELECT
							 MDCT0010_MAX.TENPO_CD
							,TO_NUMBER(SUBSTR(MAX(MDCT0010_MAX.BAIHEN_NO || MDCT0010_MAX.BAIHENKAISI_YMD), 11, 8))
							,SUBSTR(MAX(MDCT0010_MAX.BAIHEN_NO || MDCT0010_MAX.BAIHENKAISI_YMD), 1, 10)
							,MDCT0010_MAX.JISYA_HBN
							,MDCT0010_MAX.IRO_CD
						FROM
							MDCT0010 MDCT0010_MAX
						WHERE
					EXISTS( 	
						SELECT 1
						FROM W_MDCT0030
						WHERE 
						W_MDCT0030.SEQ = </parts><bind id="BIND_SEQ_04" /><parts>
						AND W_MDCT0030.UPD_YMD = MDCT0010_MAX.UPD_YMD
						AND W_MDCT0030.UPD_TM = MDCT0010_MAX.UPD_TM
						AND W_MDCT0030.UPD_TANCD = MDCT0010_MAX.UPD_TANCD
					)	
						GROUP BY
							 MDCT0010_MAX.TENPO_CD
							,MDCT0010_MAX.JISYA_HBN
							,MDCT0010_MAX.IRO_CD
					)
					GROUP BY
							 MDCT0010.JISYA_HBN
							,MDCT0010.IRO_CD
					HAVING
							NVL(SUM(ZAIKO2.FREEZAIKO_SU),0) &gt; 0
					ORDER BY
							 HANDLBL_KB 		  /* ラベル */
							,BUMON_CD			  /* 部門コード */
							,BURANDO_CD 		  /* ブランドコード */
							,KAKUTEIBAIKA_TNK2	  /* 税抜価格 */
							,JISYA_HBN			  /* 自社品番 */
							,IRO_CD 			  /* 色 */
				</parts>
			</statement>
		</sql>
		<!--売変確定(X) 明細 確定 売変確定一時TBL件数取得-->
		<sql id="TL030P01-34">
			<statement type="final" name="final">
				<parts>
					SELECT COUNT(*) CNT FROM MDCT0030_TEMP
				</parts>
			</statement>
		</sql>
	</sql-list>
</sql-included>